{"ast":null,"code":"import \"antd/lib/upload/style\";\nimport _Upload from \"antd/lib/upload\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _objectSpread from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _classCallCheck from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"D:\\\\GGdownload\\\\\\u8BBE\\u5907\\u8FD0\\u7EF4\\u524D\\u7AEF\\\\bl-device-manage\\\\src\\\\layouts\\\\BasicManage\\\\DefinePage\\\\DeviceDefine\\\\FileModal.js\";\n\nimport React, { Component } from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { UploadOutlined } from '@ant-design/icons';\nimport { Form } from '@ant-design/compatible';\nimport '@ant-design/compatible/assets/index.css';\nimport { setDeviceFileColumns, setFileType } from '../../cell/methods';\nvar Option = _Select.Option;\nvar formItemLayout = {\n  labelCol: {\n    span: 4\n  },\n  wrapperCol: {\n    span: 12\n  }\n};\nvar FileModal = (_dec = inject('DeviceDefineStore'), _dec(_class = observer(_class = (_temp =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(FileModal, _Component);\n\n  function FileModal(props) {\n    var _this;\n\n    _classCallCheck(this, FileModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(FileModal).call(this, props));\n\n    _this.onTypeChange = function (value) {\n      _this.store.getSelectModel({\n        typeId: value\n      });\n    };\n\n    _this.onModelChange = function (value) {\n      _this.setState({\n        modelId: value\n      });\n    };\n\n    _this.handleFileAdd = function () {\n      _this.setState({\n        visible: true\n      });\n    };\n\n    _this.beforeUpload = function (file, fileList) {\n      _this.setState({\n        fileName: file.name\n      });\n    };\n\n    _this.handleFileExport = function (record) {\n      window.open(\"/manage/base/file/download?fileType=\".concat(record.fileType, \"&type=\").concat(record.innertype, \"&businessId=\").concat(record.businessId, \"&businessType=1\")); // this.store.downloadFile({\n      // \tmodelId:record.modelId,\n      // \ttype:record.type\n      // })\n    };\n\n    _this.handleFileDel = function (_ref) {\n      var type = _ref.type,\n          value = _ref.value;\n\n      if (type === 'batch') {\n        if (_this.state.selectedRowKeys.length < 1) {\n          _Modal.warn({\n            title: '提示',\n            content: '请选择需要删除的文件'\n          });\n        } else {\n          _Modal.confirm({\n            title: '提示',\n            content: '确定删除选中的' + _this.state.selectedRowKeys.length + '条文件内容？',\n            okText: '确定',\n            cancelText: '取消',\n            onOk: function onOk() {\n              _this.store.delFile({\n                ids: _this.state.selectedRowKeys\n              }, 'batch');\n            }\n          });\n        }\n      } else {\n        _Modal.confirm({\n          title: '提示',\n          content: '确定删除当前文件内容？',\n          okText: '确定',\n          cancelText: '取消',\n          onOk: function onOk() {\n            _this.store.delFile({\n              id: value\n            }, 'single').then(function () {\n              var currentMain = _this.store.currentMain; //当前model\n\n              _this.store.getDeviceFileList({\n                businessType: 1,\n                id: currentMain.id\n              });\n            });\n          }\n        });\n      }\n    };\n\n    _this.handleClose = function () {\n      _this.setState({\n        visible: !_this.state.visible\n      });\n\n      var currentMain = _this.store.currentMain; //当前model\n\n      _this.store.getDeviceFileList({\n        businessType: 1,\n        id: currentMain.id\n      });\n    };\n\n    _this.handleFileSelect = function (selectedRowKeys) {\n      _this.setState({\n        selectedRowKeys: selectedRowKeys\n      });\n    };\n\n    _this.handleVisible = function () {\n      _this.store.visible = !_this.store.visible;\n    };\n\n    _this.handleSubmit = function (values) {\n      var currentMain = _this.store.currentMain;\n\n      var params = _objectSpread({}, values, currentMain);\n\n      _this.store.saveType(params);\n\n      _this.handleVisible();\n    };\n\n    _this.handleEdit = function (record) {\n      _this.store.status = 'edit';\n      _this.store.currentMain = record;\n\n      _this.handleVisible();\n    };\n\n    _this.store = _this.props.DeviceDefineStore;\n    _this.state = {\n      visible: false,\n      selectedRowKeys: [],\n      modelId: 0,\n      fileName: ''\n    };\n    return _this;\n  }\n\n  _createClass(FileModal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$store = this.store,\n          fileList = _this$store.fileList,\n          isLoading = _this$store.isLoading,\n          selectModel = _this$store.selectModel,\n          selectType = _this$store.selectType,\n          currentMain = _this$store.currentMain;\n      var rowSelection = {\n        selectedRowKeys: this.props.selectedRowKeys,\n        onChange: this.props.handleSelect\n      };\n      var onClose = this.props.onClose;\n\n      var uploadConfig = function uploadConfig(id) {\n        return {\n          name: 'file',\n          showUploadList: false,\n          action: '/manage/base/file/fileUpload',\n          headers: {\n            token: sessionStorage.getItem('selfToken')\n          },\n          multiple: true,\n          data: {\n            businessId: currentMain.id,\n            businessType: 1,\n            fileType: 1,\n            type: id\n          },\n          beforeUpload: _this2.beforeUpload,\n          onChange: function onChange(info) {\n            if (info.file.status !== 'uploading') {\n              console.log(info.file, info.fileList);\n            }\n\n            if (info.file.status === 'done') {\n              _message.success(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u6210\\u529F\"));\n            } else if (info.file.status === 'error') {\n              _message.error(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u5931\\u8D25\"));\n            }\n          }\n        };\n      };\n\n      return React.createElement(_Modal, {\n        title: '查看知识库详情',\n        visible: this.props.visible,\n        footer: React.createElement(_Button, {\n          type: \"primary\",\n          onClick: onClose,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, \"\\u5173\\u95ED\"),\n        onCancel: this.props.onClose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          marginBottom: '10px'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72\n        },\n        __self: this\n      }, React.createElement(_Button, {\n        type: \"primary\",\n        onClick: this.handleFileAdd,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73\n        },\n        __self: this\n      }, \"\\u65B0\\u589E\")), React.createElement(_Table, {\n        size: \"small\",\n        rowSelection: rowSelection,\n        dataSource: fileList,\n        columns: setDeviceFileColumns({\n          handleFileExport: this.handleFileExport,\n          handleFileDel: this.handleFileDel\n        }),\n        isLoading: isLoading,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }), this.state.visible && React.createElement(_Modal, {\n        title: \"\\u65B0\\u589E\\u6587\\u6863\",\n        visible: this.state.visible,\n        onCancel: this.handleClose,\n        onOk: this.handleClose,\n        okText: \"\\u786E\\u5B9A\",\n        cancelText: \"\\u53D6\\u6D88\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, React.createElement(Form.Item, Object.assign({}, formItemLayout, {\n        label: \"\\u8BBE\\u5907\\u7C7B\\u578B\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }), React.createElement(_Select, {\n        placeholder: \"\\u9009\\u62E9\\u8BBE\\u5907\\u7C7B\\u578B\",\n        style: {\n          width: 250\n        },\n        showSearch: true,\n        onChange: this.onTypeChange,\n        optionFilterProp: \"children\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 99\n        },\n        __self: this\n      }, selectType.length > 0 && selectType.map(function (item) {\n        return React.createElement(Option, {\n          value: item.id,\n          key: item.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 107\n          },\n          __self: this\n        }, item.id, \"_\", item.typeName);\n      }))), React.createElement(Form.Item, Object.assign({}, formItemLayout, {\n        label: \"\\u8BBE\\u5907\\u578B\\u53F7\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }), React.createElement(_Select, {\n        placeholder: \"\\u9009\\u62E9\\u8BBE\\u5907\\u578B\\u53F7\",\n        style: {\n          width: 250\n        },\n        showSearch: true,\n        onChange: this.onModelChange,\n        optionFilterProp: \"children\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, selectModel.length > 0 && selectModel.map(function (item) {\n        return React.createElement(Option, {\n          value: item.id,\n          key: item.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }, item.modelName);\n      })))), React.createElement(_Divider, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }), React.createElement(\"ul\", {\n        style: {\n          marginTop: '10px',\n          paddingLeft: '0'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, setFileType().map(function (item) {\n        return React.createElement(\"li\", {\n          key: item.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        }, React.createElement(Form.Item, Object.assign({}, formItemLayout, {\n          label: \"\\u6587\\u6863\\u7C7B\\u578B\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 135\n          },\n          __self: this\n        }), React.createElement(_Input, {\n          placeholder: \"\\u586B\\u5199\",\n          style: {\n            width: '200px'\n          },\n          value: item.typeName,\n          disabled: true,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136\n          },\n          __self: this\n        })), React.createElement(Form.Item, Object.assign({}, formItemLayout, {\n          label: \"\\u8BBE\\u5907\\u6587\\u6863\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }), React.createElement(_Upload, Object.assign({}, uploadConfig(item.id), {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }), React.createElement(_Button, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        }, React.createElement(UploadOutlined, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          },\n          __self: this\n        }), \" \\u9009\\u62E9\\u6587\\u4EF6\")), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }, \"\\u6587\\u4EF6\\u540D\\u79F0\")));\n      }))));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var currentMain = this.store.currentMain; //当前model\n\n      this.store.getDeviceFileList({\n        businessType: 1,\n        id: currentMain.id\n      });\n      this.store.getSelectType({});\n    }\n  }]);\n\n  return FileModal;\n}(Component), _temp)) || _class) || _class);\nexport default FileModal;","map":{"version":3,"sources":["D:\\GGdownload\\设备运维前端\\bl-device-manage\\src\\layouts\\BasicManage\\DefinePage\\DeviceDefine\\FileModal.js"],"names":["React","Component","inject","observer","UploadOutlined","Form","setDeviceFileColumns","setFileType","Option","formItemLayout","labelCol","span","wrapperCol","FileModal","props","onTypeChange","value","store","getSelectModel","typeId","onModelChange","setState","modelId","handleFileAdd","visible","beforeUpload","file","fileList","fileName","name","handleFileExport","record","window","open","fileType","innertype","businessId","handleFileDel","type","state","selectedRowKeys","length","warn","title","content","confirm","okText","cancelText","onOk","delFile","ids","id","then","currentMain","getDeviceFileList","businessType","handleClose","handleFileSelect","handleVisible","handleSubmit","values","params","saveType","handleEdit","status","DeviceDefineStore","isLoading","selectModel","selectType","rowSelection","onChange","handleSelect","onClose","uploadConfig","showUploadList","action","headers","token","sessionStorage","getItem","multiple","data","info","console","log","success","error","marginBottom","width","map","item","typeName","modelName","marginTop","paddingLeft","getSelectType"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { inject, observer } from 'mobx-react';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport { Form } from '@ant-design/compatible';\r\nimport '@ant-design/compatible/assets/index.css';\r\nimport { Modal, Table, Button, Select, Input, Upload, message, Divider } from 'antd';\r\nimport { setDeviceFileColumns, setFileType } from '../../cell/methods';\r\nconst { Option } = Select;\r\nconst formItemLayout = {\r\n\tlabelCol: { span: 4 },\r\n\twrapperCol: { span: 12 }\r\n};\r\n@inject('DeviceDefineStore')\r\n@observer\r\nclass FileModal extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.store = this.props.DeviceDefineStore;\r\n\t\tthis.state = {\r\n\t\t\tvisible: false,\r\n\t\t\tselectedRowKeys: [],\r\n\t\t\tmodelId: 0,\r\n\t\t\tfileName: ''\r\n\t\t};\r\n\t}\r\n\trender() {\r\n\t\tconst { fileList, isLoading, selectModel, selectType, currentMain } = this.store;\r\n\t\tconst rowSelection = {\r\n\t\t\tselectedRowKeys: this.props.selectedRowKeys,\r\n\t\t\tonChange: this.props.handleSelect\r\n\t\t};\r\n\t\tconst { onClose } = this.props;\r\n\t\tconst uploadConfig = (id) => {\r\n\t\t\treturn {\r\n\t\t\t\tname: 'file',\r\n\t\t\t\tshowUploadList: false,\r\n\t\t\t\taction: '/manage/base/file/fileUpload',\r\n\t\t\t\theaders: {\r\n\t\t\t\t\ttoken: sessionStorage.getItem('selfToken'),\r\n\t\t\t\t},\r\n\t\t\t\tmultiple: true,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tbusinessId: currentMain.id,\r\n\t\t\t\t\tbusinessType: 1,\r\n\t\t\t\t\tfileType: 1,\r\n\t\t\t\t\ttype: id,\r\n\t\t\t\t},\r\n\t\t\t\tbeforeUpload: this.beforeUpload,\r\n\t\t\t\tonChange(info) {\r\n\t\t\t\t\tif (info.file.status !== 'uploading') {\r\n\t\t\t\t\t\tconsole.log(info.file, info.fileList);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (info.file.status === 'done') {\r\n\t\t\t\t\t\tmessage.success(`${info.file.name} 上传成功`);\r\n\t\t\t\t\t} else if (info.file.status === 'error') {\r\n\t\t\t\t\t\tmessage.error(`${info.file.name} 上传失败`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn (\r\n            <Modal\r\n\t\t\t\ttitle={'查看知识库详情'}\r\n\t\t\t\tvisible={this.props.visible}\r\n\t\t\t\tfooter={\r\n\t\t\t\t\t<Button type='primary' onClick={onClose}>\r\n\t\t\t\t\t\t关闭\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t\tonCancel={this.props.onClose}\r\n\t\t\t>\r\n\t\t\t\t<div style={{ marginBottom: '10px' }}>\r\n\t\t\t\t\t<Button type='primary' onClick={this.handleFileAdd}>\r\n\t\t\t\t\t\t新增\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t{/* <Button onClick={this.handleFileAdd}>删除</Button> */}\r\n\t\t\t\t</div>\r\n\t\t\t\t<Table\r\n\t\t\t\t\tsize='small'\r\n\t\t\t\t\trowSelection={rowSelection}\r\n\t\t\t\t\tdataSource={fileList}\r\n\t\t\t\t\tcolumns={setDeviceFileColumns({\r\n\t\t\t\t\t\thandleFileExport: this.handleFileExport,\r\n\t\t\t\t\t\thandleFileDel: this.handleFileDel\r\n\t\t\t\t\t})}\r\n\t\t\t\t\tisLoading={isLoading}\r\n\t\t\t\t/>\r\n\t\t\t\t{this.state.visible && (\r\n\t\t\t\t\t<Modal\r\n\t\t\t\t\t\ttitle='新增文档'\r\n\t\t\t\t\t\tvisible={this.state.visible}\r\n\t\t\t\t\t\tonCancel={this.handleClose}\r\n\t\t\t\t\t\tonOk={this.handleClose}\r\n\t\t\t\t\t\tokText='确定'\r\n\t\t\t\t\t\tcancelText='取消'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<Form.Item {...formItemLayout} label='设备类型'>\r\n\t\t\t\t\t\t\t\t<Select\r\n\t\t\t\t\t\t\t\t\tplaceholder='选择设备类型'\r\n\t\t\t\t\t\t\t\t\tstyle={{ width: 250 }}\r\n\t\t\t\t\t\t\t\t\tshowSearch\r\n\t\t\t\t\t\t\t\t\tonChange={this.onTypeChange}\r\n\t\t\t\t\t\t\t\t\toptionFilterProp='children'\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{selectType.length > 0 && selectType.map(item => (\r\n\t\t\t\t\t\t\t\t\t\t<Option value={item.id} key={item.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t{item.id}_{item.typeName}\r\n\t\t\t\t\t\t\t\t\t\t</Option>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t\t<Form.Item {...formItemLayout} label='设备型号'>\r\n\t\t\t\t\t\t\t\t<Select\r\n\t\t\t\t\t\t\t\t\tplaceholder='选择设备型号'\r\n\t\t\t\t\t\t\t\t\tstyle={{ width: 250 }}\r\n\t\t\t\t\t\t\t\t\tshowSearch\r\n\t\t\t\t\t\t\t\t\tonChange={this.onModelChange}\r\n\t\t\t\t\t\t\t\t\toptionFilterProp='children'\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{selectModel.length > 0 &&\r\n\t\t\t\t\t\t\t\t\t\tselectModel.map(item => (\r\n\t\t\t\t\t\t\t\t\t\t\t<Option value={item.id} key={item.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{item.modelName}\r\n\t\t\t\t\t\t\t\t\t\t\t</Option>\r\n\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<Divider />\r\n\t\t\t\t\t\t<ul style={{ marginTop: '10px', paddingLeft: '0' }}>\r\n\t\t\t\t\t\t\t{setFileType().map(item => {\r\n\t\t\t\t\t\t\t\treturn (\r\n                                    <li key={item.id}>\r\n\t\t\t\t\t\t\t\t\t\t<Form.Item {...formItemLayout} label='文档类型'>\r\n\t\t\t\t\t\t\t\t\t\t\t<Input\r\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder='填写'\r\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ width: '200px' }}\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={item.typeName}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t\t\t\t\t<Form.Item {...formItemLayout} label='设备文档'>\r\n\t\t\t\t\t\t\t\t\t\t\t<Upload {...uploadConfig(item.id)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<UploadOutlined /> 选择文件\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t</Upload>\r\n\t\t\t\t\t\t\t\t\t\t\t<span>文件名称</span>\r\n\t\t\t\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t\t\t\t</li>\r\n                                );\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t</Modal>\r\n\t\t\t\t)}\r\n\t\t\t</Modal>\r\n        );\r\n\t}\r\n\tonTypeChange = value => {\r\n\t\tthis.store.getSelectModel({ typeId: value });\r\n\t};\r\n\tonModelChange = value => {\r\n\t\tthis.setState({\r\n\t\t\tmodelId: value\r\n\t\t});\r\n\t};\r\n\thandleFileAdd = () => {\r\n\t\tthis.setState({\r\n\t\t\tvisible: true\r\n\t\t});\r\n\t};\r\n\tbeforeUpload = (file, fileList) => {\r\n\t\tthis.setState({ fileName: file.name })\r\n\t}\r\n\thandleFileExport = record => {\r\n\t\twindow.open(`/manage/base/file/download?fileType=${record.fileType}&type=${record.innertype}&businessId=${record.businessId}&businessType=1`)\r\n\t\t// this.store.downloadFile({\r\n\t\t// \tmodelId:record.modelId,\r\n\t\t// \ttype:record.type\r\n\t\t// })\r\n\t};\r\n\thandleFileDel = ({ type, value }) => {\r\n\t\tif (type === 'batch') {\r\n\t\t\tif (this.state.selectedRowKeys.length < 1) {\r\n\t\t\t\tModal.warn({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '请选择需要删除的文件'\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tModal.confirm({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent:\r\n\t\t\t\t\t\t'确定删除选中的' +\r\n\t\t\t\t\t\tthis.state.selectedRowKeys.length +\r\n\t\t\t\t\t\t'条文件内容？',\r\n\t\t\t\t\tokText: '确定',\r\n\t\t\t\t\tcancelText: '取消',\r\n\t\t\t\t\tonOk: () => {\r\n\t\t\t\t\t\tthis.store.delFile(\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tids: this.state.selectedRowKeys\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t'batch'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tModal.confirm({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '确定删除当前文件内容？',\r\n\t\t\t\tokText: '确定',\r\n\t\t\t\tcancelText: '取消',\r\n\t\t\t\tonOk: () => {\r\n\t\t\t\t\tthis.store.delFile(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid: value\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t'single'\r\n\t\t\t\t\t).then(() => {\r\n\t\t\t\t\t\tconst { currentMain } = this.store; //当前model\r\n\t\t\t\t\t\tthis.store.getDeviceFileList({\r\n\t\t\t\t\t\t\tbusinessType: 1,\r\n\t\t\t\t\t\t\tid: currentMain.id\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\thandleClose = () => {\r\n\t\tthis.setState({\r\n\t\t\tvisible: !this.state.visible\r\n\t\t});\r\n\t\tconst { currentMain } = this.store; //当前model\r\n\t\tthis.store.getDeviceFileList({\r\n\t\t\tbusinessType: 1,\r\n\t\t\tid: currentMain.id\r\n\t\t});\r\n\t};\r\n\thandleFileSelect = selectedRowKeys => {\r\n\t\tthis.setState({ selectedRowKeys });\r\n\t};\r\n\t/* modal - operate */\r\n\thandleVisible = () => {\r\n\t\tthis.store.visible = !this.store.visible;\r\n\t};\r\n\t/* 弹窗提交操作 */\r\n\thandleSubmit = values => {\r\n\t\tconst { currentMain } = this.store;\r\n\t\tlet params = {\r\n\t\t\t...values,\r\n\t\t\t...currentMain\r\n\t\t};\r\n\t\tthis.store.saveType(params);\r\n\t\tthis.handleVisible();\r\n\t};\r\n\t/* 编辑弹窗 */\r\n\thandleEdit = record => {\r\n\t\tthis.store.status = 'edit';\r\n\t\tthis.store.currentMain = record;\r\n\t\tthis.handleVisible();\r\n\t};\r\n\tcomponentDidMount() {\r\n\t\tconst { currentMain } = this.store; //当前model\r\n\t\tthis.store.getDeviceFileList({\r\n\t\t\tbusinessType: 1,\r\n\t\t\tid: currentMain.id\r\n\t\t});\r\n\t\tthis.store.getSelectType({})\r\n\t}\r\n}\r\nexport default FileModal;\r\n"]},"metadata":{},"sourceType":"module"}