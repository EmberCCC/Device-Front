{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _objectSpread from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport _objectWithoutProperties from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"F:\\\\documents\\\\bl-device-manage-test\\\\src\\\\components\\\\GlobalTabel2\\\\index.js\";\n\n/*\r\n * @Author: your name\r\n * @Date: 2022-04-07 11:58:39\r\n * @LastEditTime: 2022-04-28 13:49:45\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage-test\\src\\components\\GlobalTabel\\index.js\r\n */\nimport React, { useState } from 'react';\nimport { toJS } from 'mobx';\nimport { GlobalComponent } from 'layouts/TableEdit/config';\nimport { typeName } from 'constants/status_constant';\nimport TableLayout from 'components/TableLayout';\n\nvar EditableCell = function EditableCell(_ref) {\n  var editing = _ref.editing,\n      dataIndex = _ref.dataIndex,\n      title = _ref.title,\n      inputType = _ref.inputType,\n      record = _ref.record,\n      index = _ref.index,\n      children = _ref.children,\n      itemData = _ref.itemData,\n      restProps = _objectWithoutProperties(_ref, [\"editing\", \"dataIndex\", \"title\", \"inputType\", \"record\", \"index\", \"children\", \"itemData\"]);\n\n  if (index != undefined) {\n    var item = itemData[index];\n    var ComponentInfo = GlobalComponent[item.name];\n    var re = toJS(record);\n    console.log(re[item.propertyId]);\n    return React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 33\n      },\n      __self: this\n    }, editing ? React.createElement(_Form.Item, {\n      key: index,\n      name: item.label,\n      className: \"formItemStyle\",\n      width: \"20%\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35\n      },\n      __self: this\n    }, renderDiffComponents(item, index, ComponentInfo, re[item.propertyId] || '')) : children);\n  }\n\n  return React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52\n    },\n    __self: this\n  }, children);\n};\n\nvar Option = _Select.Option;\n\nvar renderDiffComponents = function renderDiffComponents(item, indexs, ComponentInfo, value) {\n  switch (item.name) {\n    case 'Divider':\n      return React.createElement(ComponentInfo, Object.assign({\n        key: indexs\n      }, item.attr, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 61\n        },\n        __self: this\n      }));\n\n    case 'Select':\n      return React.createElement(ComponentInfo, {\n        key: indexs,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }, item.attr.options.map(function (subItem) {\n        return React.createElement(Option, {\n          key: subItem.key,\n          value: subItem.value + '',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66\n          },\n          __self: this\n        }, subItem.label);\n      }));\n\n    default:\n      return React.createElement(ComponentInfo, Object.assign({\n        key: indexs\n      }, item.attr, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }));\n  }\n};\n\nvar GlobalTabel2 = function GlobalTabel2(props) {\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var data = props.dataSource;\n  var firstFormId = props.firstFormId;\n  var secondFormId = props.secondFormId;\n  var itemDataT = props.itemDataT;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      editingKey = _useState2[0],\n      setEditingKey = _useState2[1];\n\n  var del = props.del;\n  var getData = props.getData;\n  var updataData = props.updataData;\n  var isLoading = props.loading;\n  var itemData = [];\n\n  var isEditing = function isEditing(record) {\n    return record.key === editingKey;\n  };\n\n  var edit = function edit(record) {\n    setEditingKey(record.key);\n  };\n\n  var pageChange = function pageChange(e) {\n    var page = props.PageInfo;\n    page.current = e.current;\n    page.pageIndex = e.current;\n    getData(page);\n    setEditingKey('');\n  };\n\n  var cancel = function cancel(e) {\n    // getData(page);\n    itemData = [];\n    setEditingKey('');\n  };\n\n  var changeField = function changeField() {\n    var obj = [];\n\n    if (itemDataT.length != 0) {\n      var itemData1 = itemDataT.filter(function (txt) {\n        return txt.secondFormId == secondFormId;\n      });\n\n      if (itemData1.length == 0) {\n        return [];\n      }\n\n      toJS(itemData1);\n\n      if (itemData1[0].properties != undefined && itemData1[0].properties.length != 0) {\n        var properties = {};\n        properties = toJS(itemData1[0].properties);\n        properties.forEach(function (element) {\n          var ele = {};\n          ele.label = element.name;\n          ele.attr = element.others; // delete ele.attr.value\n\n          ele.propertyId = element.propertyId;\n          ele.name = typeName[element.typeId];\n          obj.push(ele);\n        });\n      } else {\n        itemData = [];\n        return [];\n      }\n    }\n\n    itemData = obj;\n    return obj;\n  };\n\n  var save =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(key) {\n      var row, newData, index, _item, item, params;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return form.validateFields();\n\n            case 3:\n              row = _context.sent;\n              newData = _toConsumableArray(data);\n              index = newData.findIndex(function (item) {\n                return key === item.key;\n              });\n\n              if (index > -1) {\n                _item = newData[index];\n                newData.splice(index, 1, _objectSpread({}, _item, row));\n              } else {\n                newData.push(row);\n              }\n\n              item = newData[index];\n              params = {};\n              params.firstFormId = firstFormId.toString();\n              params.secondFormId = secondFormId.toString();\n              params.dataId = item.id.toString();\n\n              _Modal.confirm({\n                title: '提示',\n                content: '是否确认修改该条数据',\n                okText: '确认',\n                cancelText: '取消',\n                onOk: function onOk() {\n                  var newObj = {};\n                  Object.keys(itemData).map(function (obj) {\n                    newObj[itemData[obj].propertyId] = itemData[obj].attr.value;\n                  });\n                  params.updateData = newObj;\n                  itemData = [];\n                  updataData(params);\n                  getData();\n                  setEditingKey('');\n\n                  _message.success('修改成功');\n                },\n                onCancel: function onCancel() {\n                  console.log('Cancel');\n                }\n              });\n\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](0);\n              console.log('Validate Failed:', _context.t0);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 15]]);\n    }));\n\n    return function save(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var deleteRecord = function deleteRecord(txt) {\n    var params1 = {};\n    var params2 = {};\n    params1.firstFormId = firstFormId;\n    params2.firstFormId = firstFormId;\n    params1.secondFormId = secondFormId;\n    params1.dataId = txt.id.toString();\n\n    _Modal.confirm({\n      title: '提示',\n      content: '是否确认删除该条数据',\n      okText: '确认',\n      cancelText: '取消',\n      onOk: function onOk() {\n        del(params1);\n        getData();\n        props.countObj(params2);\n        setEditingKey('');\n\n        _message.success('删除成功');\n      },\n      onCancel: function onCancel() {\n        console.log('Cancel');\n      }\n    });\n  };\n\n  var columns = props.columns;\n  changeField();\n\n  for (var index = 0; index < columns.length - 4; index++) {\n    var element = columns[index];\n    element.editable = true;\n  }\n\n  return React.createElement(TableLayout, {\n    bordered: true,\n    dataSource: data,\n    columns: columns,\n    rowClassName: \"editable-row\",\n    pagination: props.PageInfo,\n    onChange: pageChange,\n    loading: isLoading,\n    scroll: {\n      x: 200\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  });\n};\n\nexport default GlobalTabel2;","map":{"version":3,"sources":["F:\\documents\\bl-device-manage-test\\src\\components\\GlobalTabel2\\index.js"],"names":["React","useState","toJS","GlobalComponent","typeName","TableLayout","EditableCell","editing","dataIndex","title","inputType","record","index","children","itemData","restProps","undefined","item","ComponentInfo","name","re","console","log","propertyId","label","renderDiffComponents","Option","indexs","value","attr","options","map","subItem","key","GlobalTabel2","props","useForm","form","data","dataSource","firstFormId","secondFormId","itemDataT","editingKey","setEditingKey","del","getData","updataData","isLoading","loading","isEditing","edit","pageChange","e","page","PageInfo","current","pageIndex","cancel","changeField","obj","length","itemData1","filter","txt","properties","forEach","element","ele","others","typeId","push","save","validateFields","row","newData","findIndex","splice","params","toString","dataId","id","confirm","content","okText","cancelText","onOk","newObj","Object","keys","updateData","success","onCancel","deleteRecord","params1","params2","countObj","columns","editable","x"],"mappings":"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","sourcesContent":["/*\r\n * @Author: your name\r\n * @Date: 2022-04-07 11:58:39\r\n * @LastEditTime: 2022-04-28 13:49:45\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage-test\\src\\components\\GlobalTabel\\index.js\r\n */\r\nimport React, { useState } from 'react';\r\nimport { Table, Popconfirm, Form, Select, Modal, message, Divider } from 'antd';\r\nimport { toJS } from 'mobx';\r\nimport { GlobalComponent } from 'layouts/TableEdit/config';\r\nimport { typeName } from 'constants/status_constant';\r\nimport TableLayout from 'components/TableLayout';\r\n\r\nconst EditableCell = ({\r\n  editing,\r\n  dataIndex,\r\n  title,\r\n  inputType,\r\n  record,\r\n  index,\r\n  children,\r\n  itemData,\r\n  ...restProps\r\n}) => {\r\n  if (index != undefined) {\r\n    let item = itemData[index];\r\n    const ComponentInfo = GlobalComponent[item.name]\r\n    let re = toJS(record)\r\n    console.log(re[item.propertyId]);\r\n    return (\r\n      <td>\r\n        {editing ? (\r\n          <Form.Item\r\n            key={index}\r\n            name={item.label}\r\n            className='formItemStyle'\r\n            width='20%'\r\n          >\r\n            {\r\n              renderDiffComponents(item, index, ComponentInfo, re[item.propertyId] || '')\r\n            }\r\n          </Form.Item>\r\n        ) : (\r\n          children\r\n        )}\r\n      </td>\r\n    );\r\n  }\r\n  return (\r\n    <td>\r\n      {children}\r\n    </td>\r\n  );\r\n};\r\nconst { Option } = Select;\r\nconst renderDiffComponents = (item, indexs, ComponentInfo, value) => {\r\n  switch (item.name) {\r\n    case 'Divider':\r\n      return <ComponentInfo key={indexs} {...item.attr}></ComponentInfo>\r\n    case 'Select':\r\n      return (\r\n        <ComponentInfo key={indexs}>\r\n          {\r\n            item.attr.options.map(subItem => <Option key={subItem.key} value={subItem.value + ''}>{subItem.label}</Option>)\r\n          }\r\n        </ComponentInfo>\r\n      )\r\n    default:\r\n      return <ComponentInfo key={indexs} {...item.attr} />\r\n  }\r\n}\r\nconst GlobalTabel2 = (props) => {\r\n  const [form] = Form.useForm();\r\n  const data = props.dataSource\r\n  const firstFormId = props.firstFormId\r\n  const secondFormId = props.secondFormId\r\n  const itemDataT = props.itemDataT;\r\n  const [editingKey, setEditingKey] = useState('');\r\n  const del = props.del\r\n  const getData = props.getData\r\n  const updataData = props.updataData\r\n  let isLoading = props.loading\r\n  let itemData = []\r\n  const isEditing = (record) => record.key === editingKey;\r\n  const edit = (record) => {\r\n    setEditingKey(record.key);\r\n  };\r\n\r\n  const pageChange = (e) => {\r\n    let page = props.PageInfo;\r\n    page.current = e.current\r\n    page.pageIndex = e.current;\r\n    getData(page);\r\n    setEditingKey('');\r\n  };\r\n\r\n  const cancel = (e) => {\r\n    // getData(page);\r\n    itemData = []\r\n    setEditingKey('');\r\n  };\r\n\r\n  const changeField = () => {\r\n    let obj = []\r\n    if (itemDataT.length != 0) {\r\n      let itemData1 = itemDataT.filter(function (txt) {\r\n        return txt.secondFormId == secondFormId\r\n      })\r\n      if (itemData1.length == 0) {\r\n        return [];\r\n      }\r\n      toJS(itemData1)\r\n      if (itemData1[0].properties != undefined && itemData1[0].properties.length != 0) {\r\n        let properties = {}\r\n        properties = toJS(itemData1[0].properties)\r\n        properties.forEach(element => {\r\n          let ele = {}\r\n          ele.label = element.name\r\n          ele.attr = element.others\r\n          // delete ele.attr.value\r\n          ele.propertyId = element.propertyId\r\n          ele.name = typeName[element.typeId]\r\n          obj.push(ele)\r\n        });\r\n      } else {\r\n        itemData = []\r\n        return []\r\n      }\r\n    }\r\n    itemData = obj\r\n    return obj\r\n  }\r\n  const save = async (key) => {\r\n    try {\r\n      const row = await form.validateFields();\r\n      const newData = [...data];\r\n      const index = newData.findIndex((item) => key === item.key);\r\n      if (index > -1) {\r\n        const item = newData[index];\r\n        newData.splice(index, 1, { ...item, ...row });\r\n      } else {\r\n        newData.push(row);\r\n      }\r\n      const item = newData[index];\r\n      let params = {}\r\n      params.firstFormId = firstFormId.toString()\r\n      params.secondFormId = secondFormId.toString()\r\n      params.dataId = item.id.toString()\r\n      Modal.confirm({\r\n        title: '提示',\r\n        content: '是否确认修改该条数据',\r\n        okText: '确认',\r\n        cancelText: '取消',\r\n        onOk() {\r\n          let newObj = {}\r\n          Object.keys(itemData).map((obj) => {\r\n            newObj[itemData[obj].propertyId] = itemData[obj].attr.value\r\n          })\r\n          params.updateData = newObj\r\n          itemData = []\r\n          updataData(params)\r\n          getData();\r\n          setEditingKey('')\r\n          message.success('修改成功')\r\n        },\r\n        onCancel() {\r\n          console.log('Cancel');\r\n        },\r\n      });\r\n    } catch (errInfo) {\r\n      console.log('Validate Failed:', errInfo);\r\n    }\r\n  };\r\n\r\n  const deleteRecord = (txt) => {\r\n    let params1 = {}\r\n    let params2 = {}\r\n    params1.firstFormId = firstFormId\r\n    params2.firstFormId = firstFormId\r\n    params1.secondFormId = secondFormId\r\n    params1.dataId = (txt.id).toString()\r\n    Modal.confirm({\r\n      title: '提示',\r\n      content: '是否确认删除该条数据',\r\n      okText: '确认',\r\n      cancelText: '取消',\r\n      onOk() {\r\n        del(params1)\r\n        getData()\r\n        props.countObj(params2);\r\n        setEditingKey('')\r\n        message.success('删除成功')\r\n      },\r\n      onCancel() {\r\n        console.log('Cancel');\r\n      },\r\n    });\r\n  }\r\n  const columns = props.columns\r\n  changeField();\r\n  for (let index = 0; index < columns.length - 4; index++) {\r\n    const element = columns[index];\r\n    element.editable = true\r\n  }\r\n\r\n\r\n  return (\r\n      <TableLayout\r\n        bordered\r\n        dataSource={data}\r\n        columns={columns}\r\n        rowClassName=\"editable-row\"\r\n        pagination={props.PageInfo}\r\n        onChange={pageChange}\r\n        loading={isLoading}\r\n        scroll={{x:200}}\r\n      />\r\n  );\r\n\r\n\r\n};\r\n\r\nexport default GlobalTabel2\r\n\r\n"]},"metadata":{},"sourceType":"module"}