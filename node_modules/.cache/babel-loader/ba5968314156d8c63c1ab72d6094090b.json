{"ast":null,"code":"import \"antd/lib/drawer/style\";\nimport _Drawer from \"antd/lib/drawer\";\nimport _objectSpread from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\n\nvar _dec,\n    _class,\n    _temp,\n    _jsxFileName = \"F:\\\\documents\\\\bl-device-manage-test\\\\src\\\\layouts\\\\HomeLayout\\\\index.js\";\n\nimport React, { Component } from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { isEmpty } from 'lodash';\nimport { ContainerQuery } from 'react-container-query';\nimport classnames from 'classnames';\nimport { withRouter } from 'react-router-dom';\nimport { PubSub } from 'pubsub-js';\nimport Menu from './Menu';\nimport GlobalHeader from 'components/GlobalHeader';\nimport GlobalCrumbs from 'components/GlobalCrumbs';\nimport Context from './AllContext';\nimport { Media_Query, s_size, m_size, l_size } from 'constants/configs';\nimport { judgeIsMobile } from 'utils/dataTools';\nimport ErrorNotFound from './ErrorNotFound';\nimport './index.less';\nimport GlobalModal from 'components/GlobalModal';\nimport { closeWebSocket } from 'routes/BasicRouter/webSocket';\nvar Content = _Layout.Content;\nvar Option = _Select.Option;\nvar HomeLayout = (_dec = inject('HomeStore'), withRouter(_class = _dec(_class = observer(_class = (_temp =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(HomeLayout, _Component);\n\n  function HomeLayout() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, HomeLayout);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(HomeLayout)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      collapsed: false,\n      firstMount: false,\n      messageSocket: null\n    };\n\n    _this.backToLogin = function () {\n      sessionStorage.clear();\n\n      _this.props.history.push('/login');\n    };\n\n    _this.getMediaQuery = function (params) {\n      var current;\n\n      for (var key in params) {\n        if (params[key]) {\n          current = key;\n        }\n      }\n\n      if (s_size.includes(current)) {\n        _this.props.HomeStore.changeValue('size_class', 's_size');\n      } else if (m_size.includes(current)) {\n        _this.props.HomeStore.changeValue('size_class', 'm_size');\n      } else if (l_size.includes(current)) {\n        _this.props.HomeStore.changeValue('size_class', 'l_size');\n      }\n    };\n\n    _this.getContext = function () {\n      var _this$props = _this.props,\n          location = _this$props.location,\n          breadcrumbNameMap = _this$props.breadcrumbNameMap;\n      return _objectSpread({\n        location: location,\n        breadcrumbNameMap: breadcrumbNameMap\n      }, _this.props);\n    };\n\n    _this.getLastMenu = function () {\n      var list = sessionStorage.getItem('menu') || [];\n      if (!isEmpty(list)) list = JSON.parse(list).reverse();\n      return list || [];\n    };\n\n    _this.toggle = function () {\n      _this.props.HomeStore.changeValue('collapsed', !_this.props.HomeStore.collapsed);\n\n      _this.props.HomeStore.changeValue('isClickCollapsed', true);\n    };\n\n    _this.toggleMenu = function (actionId) {\n      _this.props.HomeStore.toggleMenu({\n        actionId: actionId\n      }, function (url) {\n        if (url) {\n          _this.props.history.push(url);\n        } else {\n          alert('false');\n        }\n      });\n    };\n\n    _this.sendMsg = function () {\n      var msg = '发送消息';\n      websocket && websocket.send(msg);\n      console.log('ws发送');\n    };\n\n    _this.getMsg = function (topic, message) {\n      // alert(message);\n      // console.log('ws获取：', message)\n      var data = JSON.parse(message).result.data;\n      data.map(function (item) {\n        if (item.state == 0) {\n          _this.props.MessageStore.changeList('todoList', item);\n        } else if (item.state == 1) {\n          _this.props.MessageStore.changeList('createList', item);\n        } else if (item.state == 2) {\n          _this.props.MessageStore.changeList('handleList', item);\n        }\n      });\n      console.log(data);\n    };\n\n    return _this;\n  }\n\n  _createClass(HomeLayout, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isHome = window.location.pathname === '/index'; // const isMobile = judgeIsMobile(this.props.type).toString();\n\n      var isMobile = false;\n\n      var _toJS = toJS(this.props.HomeStore),\n          size_class = _toJS.size_class;\n\n      var isAuth = true;\n      var layout = React.createElement(_Layout, {\n        className: \"home_layout\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, isAuth && !isHome && (size_class === 's_size' ? React.createElement(_Drawer, {\n        visible: this.state.firstMount ? false : !this.props.HomeStore.collapsed,\n        placement: \"left\",\n        onClose: this.toggle,\n        width: \"200px\",\n        style: {\n          padding: 0,\n          height: '100vh'\n        },\n        bodyStyle: {\n          height: '100%',\n          padding: '0'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 44\n        },\n        __self: this\n      }, React.createElement(Menu, {\n        sizetype: size_class,\n        mobile: isMobile,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 58\n        },\n        __self: this\n      })) : React.createElement(Menu, {\n        sizetype: size_class,\n        mobile: isMobile,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60\n        },\n        __self: this\n      })), React.createElement(_Layout, {\n        className: \"right_layout\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      }, React.createElement(GlobalHeader, {\n        isAuth: isAuth,\n        sizetype: size_class,\n        mobile: isMobile,\n        ishome: isHome,\n        dataSource: toJS(this.props.HomeStore.crumbsList),\n        backToLogin: this.backToLogin,\n        visible: this.props.HomeStore.collapsed,\n        toggle: this.toggle,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63\n        },\n        __self: this\n      }), React.createElement(Content, {\n        style: {\n          margin: '8px',\n          padding: 15,\n          background: '#fff',\n          minHeight: 280,\n          overflowY: 'auto',\n          position: 'relative'\n        },\n        id: \"home_content\",\n        mobile: 'false',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71\n        },\n        __self: this\n      }, isAuth ? this.props.children : React.createElement(ErrorNotFound, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79\n        },\n        __self: this\n      }))));\n      return React.createElement(\"div\", {\n        id: \"Assets\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      }, React.createElement(ContainerQuery, {\n        query: Media_Query,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85\n        },\n        __self: this\n      }, function (params) {\n        _this2.getMediaQuery(params);\n\n        return React.createElement(Context.Provider, {\n          value: _this2.getContext(),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: classnames(params),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89\n          },\n          __self: this\n        }, layout));\n      }));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      this.setState({\n        firstMount: true,\n        messageSocket: PubSub.subscribe('message', this.getMsg)\n      });\n      /* 进入即请求菜单 */\n\n      if (this.props.history.location.pathname !== '/login') {\n        this.props.HomeStore.getMenuList().then(function (url) {\n          if (_this3.props.history.location.pathname.indexOf('index') === -1) {\n            _this3.props.history.push(url);\n\n            _this3.props.HomeStore.initMenu(_this3.props.history.location.pathname);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      //在组件卸载的时候，关闭连接\n      PubSub.unsubscribe(this.state.messageSocket);\n      closeWebSocket();\n      this.setState({\n        messageSocket: null\n      });\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(props, state) {\n      return {\n        firstMount: false\n      };\n    }\n  }]);\n\n  return HomeLayout;\n}(Component), _temp)) || _class) || _class) || _class);\nexport default HomeLayout;","map":{"version":3,"sources":["F:\\documents\\bl-device-manage-test\\src\\layouts\\HomeLayout\\index.js"],"names":["React","Component","inject","observer","toJS","isEmpty","ContainerQuery","classnames","withRouter","PubSub","Menu","GlobalHeader","GlobalCrumbs","Context","Media_Query","s_size","m_size","l_size","judgeIsMobile","ErrorNotFound","GlobalModal","closeWebSocket","Content","Option","HomeLayout","state","collapsed","firstMount","messageSocket","backToLogin","sessionStorage","clear","props","history","push","getMediaQuery","params","current","key","includes","HomeStore","changeValue","getContext","location","breadcrumbNameMap","getLastMenu","list","getItem","JSON","parse","reverse","toggle","toggleMenu","actionId","url","alert","sendMsg","msg","websocket","send","console","log","getMsg","topic","message","data","result","map","item","MessageStore","changeList","isHome","window","pathname","isMobile","size_class","isAuth","layout","padding","height","crumbsList","margin","background","minHeight","overflowY","position","children","setState","subscribe","getMenuList","then","indexOf","initMenu","unsubscribe"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { inject, observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport { isEmpty } from 'lodash';\nimport { ContainerQuery } from 'react-container-query';\nimport classnames from 'classnames';\nimport { withRouter } from 'react-router-dom';\nimport { PubSub } from 'pubsub-js';\nimport Menu from './Menu';\nimport GlobalHeader from 'components/GlobalHeader';\nimport GlobalCrumbs from 'components/GlobalCrumbs';\nimport Context from './AllContext';\nimport { Media_Query, s_size, m_size, l_size } from 'constants/configs';\nimport { Layout, Drawer, Select } from 'antd';\n\n\nimport { judgeIsMobile } from 'utils/dataTools';\nimport ErrorNotFound from './ErrorNotFound';\nimport './index.less';\nimport GlobalModal from 'components/GlobalModal';\nimport { closeWebSocket } from 'routes/BasicRouter/webSocket';\n\nconst { Content } = Layout;\nconst { Option } = Select;\n@withRouter\n@inject('HomeStore')\n@observer\nclass HomeLayout extends Component {\n  state = {\n    collapsed: false,\n    firstMount: false,\n    messageSocket: null\n  };\n\n  render() {\n    const isHome = window.location.pathname === '/index';\n    // const isMobile = judgeIsMobile(this.props.type).toString();\n    const isMobile = false;\n    const { size_class, } = toJS(this.props.HomeStore);\n    const isAuth = true;\n    const layout = <Layout className='home_layout'>\n      {\n        isAuth && !isHome && (size_class === 's_size' ?\n          <Drawer\n            visible={this.state.firstMount ? false : !this.props.HomeStore.collapsed}\n            placement=\"left\"\n            onClose={this.toggle}\n            width='200px'\n            style={{\n              padding: 0,\n              height: '100vh',\n            }}\n            bodyStyle={{\n              height: '100%',\n              padding: '0'\n            }}\n          >\n            <Menu sizetype={size_class} mobile={isMobile} />\n          </Drawer>\n          : <Menu sizetype={size_class} mobile={isMobile} />)\n      }\n      <Layout className='right_layout'>\n        <GlobalHeader\n          isAuth={isAuth}\n          sizetype={size_class}\n          mobile={isMobile}\n          ishome={isHome}\n          dataSource={toJS(this.props.HomeStore.crumbsList)}\n          backToLogin={this.backToLogin}\n          visible={this.props.HomeStore.collapsed} toggle={this.toggle} />\n        <Content\n          style={{\n            margin: '8px', padding: 15, background: '#fff', minHeight: 280,\n            overflowY: 'auto', position: 'relative'\n          }}\n          id='home_content'\n          mobile={'false'}\n        >\n          {(isAuth ? this.props.children : <ErrorNotFound />)}\n        </Content>\n      </Layout>\n    </Layout>;\n    return (\n      <div id='Assets'>\n        <ContainerQuery query={Media_Query}>\n          {params => {\n            this.getMediaQuery(params);\n            return <Context.Provider value={this.getContext()}>\n              <div className={classnames(params)}>\n                {layout}\n              </div>\n            </Context.Provider>\n          }}\n        </ContainerQuery>\n\n      </div>\n    );\n  }\n  backToLogin = () => {\n    sessionStorage.clear();\n    this.props.history.push('/login')\n  }\n  getMediaQuery = (params) => {\n    let current;\n    for (let key in params) {\n      if (params[key]) {\n        current = key;\n      }\n    }\n    if (s_size.includes(current)) {\n      this.props.HomeStore.changeValue('size_class', 's_size');\n    } else if (m_size.includes(current)) {\n      this.props.HomeStore.changeValue('size_class', 'm_size');\n    } else if (l_size.includes(current)) {\n      this.props.HomeStore.changeValue('size_class', 'l_size');\n    }\n  }\n  getContext = () => {\n    const { location, breadcrumbNameMap } = this.props;\n    return {\n      location,\n      breadcrumbNameMap,\n      ...this.props\n    };\n  }\n  getLastMenu = () => {\n    let list = sessionStorage.getItem('menu') || [];\n    if (!isEmpty(list))\n      list = JSON.parse(list).reverse();\n    return list || [];\n  }\n\n  toggle = () => {\n    this.props.HomeStore.changeValue('collapsed', !this.props.HomeStore.collapsed);\n    this.props.HomeStore.changeValue('isClickCollapsed', true);\n  }\n  toggleMenu = (actionId) => {\n    this.props.HomeStore.toggleMenu({ actionId }, (url) => {\n      if (url) {\n        this.props.history.push(url);\n      } else {\n        alert('false');\n      }\n    });\n  }\n  static getDerivedStateFromProps(props, state) {\n    return {\n      firstMount: false,\n    }\n  }\n  sendMsg = () => {\n    let msg = '发送消息'\n    websocket && websocket.send(msg)\n    console.log('ws发送')\n  }\n\n  getMsg = (topic, message) => {\n    // alert(message);\n    // console.log('ws获取：', message)\n    let data = JSON.parse(message).result.data\n    data.map((item) => {\n      if (item.state == 0) {\n        this.props.MessageStore.changeList('todoList', item);\n      } else if (item.state == 1) {\n        this.props.MessageStore.changeList('createList', item);\n      } else if (item.state == 2) {\n        this.props.MessageStore.changeList('handleList', item);\n      }\n    })\n    console.log(data);\n  }\n  componentDidMount() {\n    this.setState({\n      firstMount: true,\n      messageSocket: PubSub.subscribe('message', this.getMsg)\n    });\n    /* 进入即请求菜单 */\n    if (this.props.history.location.pathname !== '/login') {\n      this.props.HomeStore.getMenuList().then((url) => {\n        if (this.props.history.location.pathname.indexOf('index') === -1) {\n          this.props.history.push(url)\n          this.props.HomeStore.initMenu(this.props.history.location.pathname)\n        }\n      })\n    }\n  }\n  componentWillUnmount() {\n    //在组件卸载的时候，关闭连接\n    PubSub.unsubscribe(this.state.messageSocket);\n    closeWebSocket();\n    this.setState({\n      messageSocket: null\n    })\n  }\n}\nexport default HomeLayout;"]},"metadata":{},"sourceType":"module"}