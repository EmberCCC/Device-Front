{"ast":null,"code":"import \"antd/lib/checkbox/style\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _defineProperty from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\nvar _jsxFileName = \"F:\\\\documents\\\\bl-device-manage-test\\\\src\\\\layouts\\\\FlowManage\\\\index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useState, useRef, useCallback, useMemo, useEffect } from 'react';\nimport ReactFlow, { ReactFlowProvider, addEdge, useNodesState, useEdgesState, Controls, MiniMap, MarkerType } from 'react-flow-renderer';\nimport * as services from '../../services/design';\nimport Sidebar from './Sidebar';\nimport FlowNode from './Node/FlowNode';\nimport CopyNode from './Node/CopyNode';\nimport EndNode from './Node/EndNode';\nimport './index.css';\nimport { isDataExist } from 'utils/dataTools';\nimport { observable } from 'mobx';\nimport { inject, observer } from 'mobx-react';\nvar Header = _Layout.Header,\n    Sider = _Layout.Sider,\n    Content = _Layout.Content;\nvar Option = _Select.Option;\nvar initialNodes = [{\n  \"id\": \"0\",\n  \"type\": \"input\",\n  \"data\": {\n    \"label\": \"开始流程\",\n    'person': []\n  },\n  \"position\": {\n    \"x\": 254,\n    \"y\": -76\n  },\n  \"positionAbsolute\": {\n    \"x\": 254,\n    \"y\": -76\n  }\n}, {\n  \"id\": \"-1\",\n  \"type\": \"end\",\n  \"data\": {\n    \"label\": \"结束流程\",\n    'person': []\n  },\n  \"position\": {\n    \"x\": 198,\n    \"y\": 112\n  },\n  \"positionAbsolute\": {\n    \"x\": 198,\n    \"y\": 112\n  }\n}, {\n  \"id\": \"node_1\",\n  \"type\": \"FlowNode\",\n  \"position\": {\n    \"x\": 236.25,\n    \"y\": 32.5\n  },\n  \"data\": {\n    \"label\": \"FlowNode node\",\n    'person': []\n  },\n  \"positionAbsolute\": {\n    \"x\": 236.25,\n    \"y\": 32.5\n  }\n}];\nvar initialEdges = [{\n  \"source\": \"0\",\n  \"sourceHandle\": null,\n  \"target\": \"node_1\",\n  \"targetHandle\": \"top\",\n  \"markerEnd\": {\n    \"type\": \"arrow\"\n  },\n  \"id\": \"reactflow__edge-0-node_1top\"\n}, {\n  \"source\": \"node_1\",\n  \"sourceHandle\": \"bottom\",\n  \"target\": \"-1\",\n  \"targetHandle\": null,\n  \"markerEnd\": {\n    \"type\": \"arrow\"\n  },\n  \"id\": \"reactflow__edge-node_1bottom--1\"\n}];\nvar nodeTypes = {\n  FlowNode: FlowNode,\n  CopyNode: CopyNode,\n  end: EndNode\n};\nvar id = 0;\n\nvar getId = function getId() {\n  return \"node_\".concat(++id);\n}; // function DnDFlow(props) {\n//   const reactFlowWrapper = useRef(null);\n//   const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\n//   const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\n//   const [perArr, setPerArr] = useState([]);\n//   const [reactFlowInstance, setReactFlowInstance] = useState(null);\n//   const [nodeName, setNodeName] = useState('');\n//   const [nodeId, setNodeId] = useState('');\n//   const [person, setPerson] = useState({});\n//   const [children, setChildren] = useState([])\n//   const field = [];\n//   let fieldProp = {};\n//   field.map((item) => {\n//     fieldProp[item.propertyId] = []\n//   })\n//   useEffect(() => {\n//     // let personList = Object.assign({}, props.location.state.PersonListT)\n//     // console.log(person);\n//     // let newC = []\n//     // Object.keys(personList).map((item) => {\n//     //   if (personList[item] != undefined) {\n//     //     newC.push(<Option key={personList[item].id}>{personList[item].nickName}</Option>)\n//     //   }\n//     // })\n//     // setPerson(personList);\n//     // setChildren(newC);\n//   }, [])\n//   useEffect(() => {\n//     setNodes((nds) =>\n//       nds.map((node) => {\n//         if (node.id === nodeId) {\n//           // it's important that you create a new object here\n//           // in order to notify react flow about the change\n//           node.data = {\n//             ...node.data,\n//             label: nodeName,\n//             person: perArr\n//           };\n//         }\n//         return node;\n//       })\n//     );\n//   }, [nodeName, setNodeName, perArr, setPerArr]);\n//   const onConnect = useCallback((params) => {\n//     let obj = {\n//       type: MarkerType.Arrow,\n//     }\n//     params.markerEnd = obj\n//     setEdges((eds) => addEdge(params, eds))\n//   }, []);\n//   const onDragOver = useCallback((event) => {\n//     event.preventDefault();\n//     event.dataTransfer.dropEffect = 'move';\n//   }, []);\n//   const onDrop = useCallback(\n//     (event) => {\n//       event.preventDefault();\n//       const reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\n//       const type = event.dataTransfer.getData('application/reactflow');\n//       // check if the dropped element is valid\n//       if (typeof type === 'undefined' || !type) {\n//         return;\n//       }\n//       const position = reactFlowInstance.project({\n//         x: event.clientX - reactFlowBounds.left,\n//         y: event.clientY - reactFlowBounds.top,\n//       });\n//       const newNode = {\n//         id: getId(),\n//         type,\n//         position,\n//         data: { label: `${type} node` },\n//       };\n//       setNodes((nds) => nds.concat(newNode));\n//     },\n//     [reactFlowInstance]\n//   );\n//   const onSave = useCallback(() => {\n//     if (reactFlowInstance) {\n//       const flow = reactFlowInstance.toObject();\n//       // personList = Object.assign({},props.location.state.PersonListT)\n//       let params = {}\n//       params.firstFormId = props.location.state.firstFormId;\n//       params.edges = flow.edges\n//       params.nodes = []\n//       flow.nodes.map((item) => {\n//         let obj = {}\n//         obj.id = item.id\n//         obj.type = item.type\n//         obj.position = item.position\n//         obj.positionAbsolute = item.positionAbsolute\n//         if (item.data.person != undefined && item.data.person.length != 0) {\n//           let person1 = person[Number(item.data.person) - 1]\n//           item.data.principal = person1['username'];\n//           item.data.userId = person1['id'];\n//         }\n//         obj.data = item.data\n//         params.nodes.push(obj)\n//       })\n//       console.log(params);\n//       try {\n//         let res = services.putRequest(services.requestList.addFlow, params);\n//         if (isDataExist(res)) {\n//           return res;\n//         }\n//       } catch (error) {\n//         console.log(error);\n//       }\n//     }\n//   }, [reactFlowInstance]);\n//   const onNodeClick = useCallback((event, node) => {\n//     setNodeId(node.id)\n//     setPerArr(node.data.person)\n//     setNodeName(node.data.label)\n//   }, [nodeName], [nodeId])\n//   const handleChange = (value) => {\n//     setPerArr(value);\n//     console.log(`selected ${value}`);\n//   }\n//   function checkChange(checkedValues, a) {\n//     fieldProp[a] = checkedValues\n//   }\n//   return (\n//     <Layout>\n//       <Header className='header'>\n//         <Button type=\"primary\" className='save' onClick={onSave}>保存</Button>\n//       </Header>\n//       <Layout>\n//         <Content>\n//           <Layout>\n//             <Header className='title'>\n//               <Sidebar />\n//             </Header>\n//             <Content>\n//               <div className=\"dndflow\">\n//                 <ReactFlowProvider>\n//                   <Content>\n//                     <div className=\"reactflow-wrapper\" ref={reactFlowWrapper}>\n//                       <ReactFlow\n//                         nodes={nodes}\n//                         edges={edges}\n//                         onNodesChange={onNodesChange}\n//                         onEdgesChange={onEdgesChange}\n//                         onConnect={onConnect}\n//                         onInit={setReactFlowInstance}\n//                         onDrop={onDrop}\n//                         onDragOver={onDragOver}\n//                         nodeTypes={nodeTypes}\n//                         onNodeClick={onNodeClick}\n//                         fitView\n//                       >\n//                         <Controls />\n//                         <MiniMap />\n//                       </ReactFlow>\n//                     </div>\n//                   </Content>\n//                 </ReactFlowProvider>\n//               </div>\n//             </Content>\n//           </Layout>\n//         </Content>\n//         <Sider style={{ backgroundColor: 'white' }} width='300'>\n//           <div className=\"updatenode__controls\">\n//             <div>\n//               <label>节点名:</label>\n//               <input value={nodeName} onChange={(evt) => setNodeName(evt.target.value)} />\n//             </div>\n//             <div>\n//               <label>负责人：</label>\n//               <Select\n//                 // mode=\"multiple\"\n//                 allowClear\n//                 style={{ width: '80%', marginTop: '10px' }}\n//                 placeholder=\"Please select\"\n//                 value={perArr}\n//                 onChange={handleChange}\n//               >\n//                 {children}\n//               </Select>\n//             </div>\n//             {\n//               field.map((item) => {\n//                 return <div className='dataInfo'>\n//                   <label>{item.name}:</label>\n//                   <Checkbox.Group name={item.propertyId} options={[{ label: '可见', value: 'vis' }, { label: '可编辑', value: 'edit' }]} onChange={(checkedValues) => checkChange(checkedValues, item.propertyId)}></Checkbox.Group>\n//                 </div>\n//               })\n//             }\n//           </div>\n//         </Sider>\n//       </Layout>\n//     </Layout>\n//   );\n// };\n\n\nvar DnDFlow = function DnDFlow(_ref) {\n  var HomeStore = _ref.HomeStore;\n  var reactFlowWrapper = useRef(null);\n\n  var _useNodesState = useNodesState(initialNodes),\n      _useNodesState2 = _slicedToArray(_useNodesState, 3),\n      nodes = _useNodesState2[0],\n      setNodes = _useNodesState2[1],\n      onNodesChange = _useNodesState2[2];\n\n  var _useEdgesState = useEdgesState(initialEdges),\n      _useEdgesState2 = _slicedToArray(_useEdgesState, 3),\n      edges = _useEdgesState2[0],\n      setEdges = _useEdgesState2[1],\n      onEdgesChange = _useEdgesState2[2];\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      perArr = _useState2[0],\n      setPerArr = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      reactFlowInstance = _useState4[0],\n      setReactFlowInstance = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      nodeName = _useState6[0],\n      setNodeName = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      nodeId = _useState8[0],\n      setNodeId = _useState8[1];\n\n  var _useState9 = useState({}),\n      _useState10 = _slicedToArray(_useState9, 2),\n      person = _useState10[0],\n      setPerson = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      children = _useState12[0],\n      setChildren = _useState12[1];\n\n  var field = [];\n  var fieldProp = {};\n  field.map(function (item) {\n    fieldProp[item.propertyId] = [];\n  });\n  useEffect(function () {\n    console.log(HomeStore.firstFormId);\n    var personList = Object.assign({}, props.location.state.PersonListT);\n    console.log(person);\n    var newC = [];\n    Object.keys(personList).map(function (item) {\n      if (personList[item] != undefined) {\n        newC.push( /*#__PURE__*/React.createElement(Option, {\n          key: personList[item].id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 335\n          },\n          __self: this\n        }, personList[item].nickName));\n      }\n    });\n    setPerson(personList);\n    setChildren(newC);\n  }, []);\n  useEffect(function () {\n    setNodes(function (nds) {\n      return nds.map(function (node) {\n        if (node.id === nodeId) {\n          // it's important that you create a new object here\n          // in order to notify react flow about the change\n          node.data = _objectSpread(_objectSpread({}, node.data), {}, {\n            label: nodeName,\n            person: perArr\n          });\n        }\n\n        return node;\n      });\n    });\n  }, [nodeName, setNodeName, perArr, setPerArr]);\n  var onConnect = useCallback(function (params) {\n    var obj = {\n      type: MarkerType.Arrow\n    };\n    params.markerEnd = obj;\n    setEdges(function (eds) {\n      return addEdge(params, eds);\n    });\n  }, []);\n  var onDragOver = useCallback(function (event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = 'move';\n  }, []);\n  var onDrop = useCallback(function (event) {\n    event.preventDefault();\n    var reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\n    var type = event.dataTransfer.getData('application/reactflow'); // check if the dropped element is valid\n\n    if (typeof type === 'undefined' || !type) {\n      return;\n    }\n\n    var position = reactFlowInstance.project({\n      x: event.clientX - reactFlowBounds.left,\n      y: event.clientY - reactFlowBounds.top\n    });\n    var newNode = {\n      id: getId(),\n      type: type,\n      position: position,\n      data: {\n        label: \"\".concat(type, \" node\")\n      }\n    };\n    setNodes(function (nds) {\n      return nds.concat(newNode);\n    });\n  }, [reactFlowInstance]);\n  var onSave = useCallback(function () {\n    if (reactFlowInstance) {\n      var flow = reactFlowInstance.toObject(); // personList = Object.assign({},props.location.state.PersonListT)\n\n      var params = {};\n      params.firstFormId = props.location.state.firstFormId;\n      params.edges = flow.edges;\n      params.nodes = [];\n      flow.nodes.map(function (item) {\n        var obj = {};\n        obj.id = item.id;\n        obj.type = item.type;\n        obj.position = item.position;\n        obj.positionAbsolute = item.positionAbsolute;\n\n        if (item.data.person != undefined && item.data.person.length != 0) {\n          var person1 = person[Number(item.data.person) - 1];\n          item.data.principal = person1['username'];\n          item.data.userId = person1['id'];\n        }\n\n        obj.data = item.data;\n        params.nodes.push(obj);\n      });\n      console.log(params);\n\n      try {\n        var res = services.putRequest(services.requestList.addFlow, params);\n\n        if (isDataExist(res)) {\n          return res;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }, [reactFlowInstance]);\n  var onNodeClick = useCallback(function (event, node) {\n    setNodeId(node.id);\n    setPerArr(node.data.person);\n    setNodeName(node.data.label);\n  }, [nodeName], [nodeId]);\n\n  var handleChange = function handleChange(value) {\n    setPerArr(value);\n    console.log(\"selected \".concat(value));\n  };\n\n  function checkChange(checkedValues, a) {\n    fieldProp[a] = checkedValues;\n  }\n\n  return /*#__PURE__*/React.createElement(_Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 448\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Header, {\n    className: \"header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 449\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    className: \"save\",\n    onClick: onSave,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 450\n    },\n    __self: this\n  }, \"\\u4FDD\\u5B58\")), /*#__PURE__*/React.createElement(_Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Content, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 453\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(_Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 454\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Header, {\n    className: \"title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 455\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Sidebar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 456\n    },\n    __self: this\n  })), /*#__PURE__*/React.createElement(Content, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 458\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dndflow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(ReactFlowProvider, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Content, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 461\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"reactflow-wrapper\",\n    ref: reactFlowWrapper,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 462\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(ReactFlow, {\n    nodes: nodes,\n    edges: edges,\n    onNodesChange: onNodesChange,\n    onEdgesChange: onEdgesChange,\n    onConnect: onConnect,\n    onInit: setReactFlowInstance,\n    onDrop: onDrop,\n    onDragOver: onDragOver,\n    nodeTypes: nodeTypes,\n    onNodeClick: onNodeClick,\n    fitView: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 463\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(Controls, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 476\n    },\n    __self: this\n  }), /*#__PURE__*/React.createElement(MiniMap, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 477\n    },\n    __self: this\n  }))))))))), /*#__PURE__*/React.createElement(Sider, {\n    style: {\n      backgroundColor: 'white'\n    },\n    width: \"300\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 486\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"updatenode__controls\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 487\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 488\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 489\n    },\n    __self: this\n  }, \"\\u8282\\u70B9\\u540D:\"), /*#__PURE__*/React.createElement(\"input\", {\n    value: nodeName,\n    onChange: function onChange(evt) {\n      return setNodeName(evt.target.value);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 490\n    },\n    __self: this\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 492\n    },\n    __self: this\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 493\n    },\n    __self: this\n  }, \"\\u8D1F\\u8D23\\u4EBA\\uFF1A\"), /*#__PURE__*/React.createElement(_Select, {\n    // mode=\"multiple\"\n    allowClear: true,\n    style: {\n      width: '80%',\n      marginTop: '10px'\n    },\n    placeholder: \"Please select\",\n    value: perArr,\n    onChange: handleChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 494\n    },\n    __self: this\n  }, children)), field.map(function (item) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"dataInfo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 507\n      },\n      __self: this\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 508\n      },\n      __self: this\n    }, item.name, \":\"), /*#__PURE__*/React.createElement(_Checkbox.Group, {\n      name: item.propertyId,\n      options: [{\n        label: '可见',\n        value: 'vis'\n      }, {\n        label: '可编辑',\n        value: 'edit'\n      }],\n      onChange: function onChange(checkedValues) {\n        return checkChange(checkedValues, item.propertyId);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 509\n      },\n      __self: this\n    }));\n  })))));\n};\n\nexport default inject('HomeStore')(observer(DnDFlow));","map":{"version":3,"names":["React","useState","useRef","useCallback","useMemo","useEffect","ReactFlow","ReactFlowProvider","addEdge","useNodesState","useEdgesState","Controls","MiniMap","MarkerType","services","Sidebar","FlowNode","CopyNode","EndNode","isDataExist","observable","inject","observer","Header","Sider","Content","Option","initialNodes","initialEdges","nodeTypes","end","id","getId","DnDFlow","HomeStore","reactFlowWrapper","nodes","setNodes","onNodesChange","edges","setEdges","onEdgesChange","perArr","setPerArr","reactFlowInstance","setReactFlowInstance","nodeName","setNodeName","nodeId","setNodeId","person","setPerson","children","setChildren","field","fieldProp","map","item","propertyId","console","log","firstFormId","personList","Object","assign","props","location","state","PersonListT","newC","keys","undefined","push","nickName","nds","node","data","label","onConnect","params","obj","type","Arrow","markerEnd","eds","onDragOver","event","preventDefault","dataTransfer","dropEffect","onDrop","reactFlowBounds","current","getBoundingClientRect","getData","position","project","x","clientX","left","y","clientY","top","newNode","concat","onSave","flow","toObject","positionAbsolute","length","person1","Number","principal","userId","res","putRequest","requestList","addFlow","error","onNodeClick","handleChange","value","checkChange","checkedValues","a","backgroundColor","evt","target","width","marginTop","name"],"sources":["F:/documents/bl-device-manage-test/src/layouts/FlowManage/index.js"],"sourcesContent":["import React, { useState, useRef, useCallback, useMemo, useEffect } from 'react';\r\nimport { Layout, Button, Menu, Dropdown, Divider, Select, Checkbox, List, message } from 'antd';\r\nimport ReactFlow, {\r\n  ReactFlowProvider,\r\n  addEdge,\r\n  useNodesState,\r\n  useEdgesState,\r\n  Controls,\r\n  MiniMap,\r\n  MarkerType\r\n} from 'react-flow-renderer';\r\nimport * as services from '../../services/design';\r\nimport Sidebar from './Sidebar';\r\nimport FlowNode from './Node/FlowNode'\r\nimport CopyNode from './Node/CopyNode'\r\nimport EndNode from './Node/EndNode'\r\n\r\nimport './index.css';\r\nimport { isDataExist } from 'utils/dataTools';\r\nimport { observable } from 'mobx';\r\nimport { inject, observer } from 'mobx-react';\r\n\r\nconst { Header, Sider, Content } = Layout;\r\nconst { Option } = Select;\r\nconst initialNodes = [\r\n  {\r\n    \"id\": \"0\",\r\n    \"type\": \"input\",\r\n    \"data\": {\r\n      \"label\": \"开始流程\",\r\n      'person': []\r\n    },\r\n    \"position\": {\r\n      \"x\": 254,\r\n      \"y\": -76\r\n    },\r\n    \"positionAbsolute\": {\r\n      \"x\": 254,\r\n      \"y\": -76\r\n    }\r\n  },\r\n  {\r\n    \"id\": \"-1\",\r\n    \"type\": \"end\",\r\n    \"data\": {\r\n      \"label\": \"结束流程\",\r\n      'person': []\r\n\r\n    },\r\n    \"position\": {\r\n      \"x\": 198,\r\n      \"y\": 112\r\n    },\r\n    \"positionAbsolute\": {\r\n      \"x\": 198,\r\n      \"y\": 112\r\n    }\r\n  },\r\n  {\r\n    \"id\": \"node_1\",\r\n    \"type\": \"FlowNode\",\r\n    \"position\": {\r\n      \"x\": 236.25,\r\n      \"y\": 32.5\r\n    },\r\n    \"data\": {\r\n      \"label\": \"FlowNode node\",\r\n      'person': []\r\n    },\r\n    \"positionAbsolute\": {\r\n      \"x\": 236.25,\r\n      \"y\": 32.5\r\n    }\r\n  }\r\n];\r\nconst initialEdges = [\r\n  {\r\n    \"source\": \"0\",\r\n    \"sourceHandle\": null,\r\n    \"target\": \"node_1\",\r\n    \"targetHandle\": \"top\",\r\n    \"markerEnd\": {\r\n      \"type\": \"arrow\"\r\n    },\r\n    \"id\": \"reactflow__edge-0-node_1top\"\r\n  },\r\n  {\r\n    \"source\": \"node_1\",\r\n    \"sourceHandle\": \"bottom\",\r\n    \"target\": \"-1\",\r\n    \"targetHandle\": null,\r\n    \"markerEnd\": {\r\n      \"type\": \"arrow\"\r\n    },\r\n    \"id\": \"reactflow__edge-node_1bottom--1\"\r\n  }\r\n]\r\nconst nodeTypes = { FlowNode: FlowNode, CopyNode: CopyNode, end: EndNode };\r\n\r\nlet id = 0;\r\nconst getId = () => `node_${++id}`;\r\n\r\n// function DnDFlow(props) {\r\n//   const reactFlowWrapper = useRef(null);\r\n//   const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\r\n//   const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\r\n//   const [perArr, setPerArr] = useState([]);\r\n//   const [reactFlowInstance, setReactFlowInstance] = useState(null);\r\n//   const [nodeName, setNodeName] = useState('');\r\n//   const [nodeId, setNodeId] = useState('');\r\n//   const [person, setPerson] = useState({});\r\n//   const [children, setChildren] = useState([])\r\n\r\n//   const field = [];\r\n//   let fieldProp = {};\r\n//   field.map((item) => {\r\n//     fieldProp[item.propertyId] = []\r\n//   })\r\n//   useEffect(() => {\r\n//     // let personList = Object.assign({}, props.location.state.PersonListT)\r\n//     // console.log(person);\r\n//     // let newC = []\r\n//     // Object.keys(personList).map((item) => {\r\n//     //   if (personList[item] != undefined) {\r\n//     //     newC.push(<Option key={personList[item].id}>{personList[item].nickName}</Option>)\r\n//     //   }\r\n//     // })\r\n//     // setPerson(personList);\r\n//     // setChildren(newC);\r\n//   }, [])\r\n//   useEffect(() => {\r\n//     setNodes((nds) =>\r\n//       nds.map((node) => {\r\n//         if (node.id === nodeId) {\r\n//           // it's important that you create a new object here\r\n//           // in order to notify react flow about the change\r\n//           node.data = {\r\n//             ...node.data,\r\n//             label: nodeName,\r\n//             person: perArr\r\n//           };\r\n//         }\r\n//         return node;\r\n//       })\r\n//     );\r\n//   }, [nodeName, setNodeName, perArr, setPerArr]);\r\n\r\n//   const onConnect = useCallback((params) => {\r\n//     let obj = {\r\n//       type: MarkerType.Arrow,\r\n//     }\r\n//     params.markerEnd = obj\r\n//     setEdges((eds) => addEdge(params, eds))\r\n//   }, []);\r\n\r\n//   const onDragOver = useCallback((event) => {\r\n//     event.preventDefault();\r\n//     event.dataTransfer.dropEffect = 'move';\r\n//   }, []);\r\n\r\n//   const onDrop = useCallback(\r\n//     (event) => {\r\n//       event.preventDefault();\r\n\r\n//       const reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\r\n//       const type = event.dataTransfer.getData('application/reactflow');\r\n\r\n//       // check if the dropped element is valid\r\n//       if (typeof type === 'undefined' || !type) {\r\n//         return;\r\n//       }\r\n\r\n//       const position = reactFlowInstance.project({\r\n//         x: event.clientX - reactFlowBounds.left,\r\n//         y: event.clientY - reactFlowBounds.top,\r\n//       });\r\n//       const newNode = {\r\n//         id: getId(),\r\n//         type,\r\n//         position,\r\n//         data: { label: `${type} node` },\r\n//       };\r\n\r\n//       setNodes((nds) => nds.concat(newNode));\r\n//     },\r\n//     [reactFlowInstance]\r\n//   );\r\n\r\n//   const onSave = useCallback(() => {\r\n//     if (reactFlowInstance) {\r\n//       const flow = reactFlowInstance.toObject();\r\n//       // personList = Object.assign({},props.location.state.PersonListT)\r\n//       let params = {}\r\n//       params.firstFormId = props.location.state.firstFormId;\r\n//       params.edges = flow.edges\r\n//       params.nodes = []\r\n//       flow.nodes.map((item) => {\r\n//         let obj = {}\r\n//         obj.id = item.id\r\n//         obj.type = item.type\r\n//         obj.position = item.position\r\n//         obj.positionAbsolute = item.positionAbsolute\r\n//         if (item.data.person != undefined && item.data.person.length != 0) {\r\n//           let person1 = person[Number(item.data.person) - 1]\r\n//           item.data.principal = person1['username'];\r\n//           item.data.userId = person1['id'];\r\n//         }\r\n//         obj.data = item.data\r\n//         params.nodes.push(obj)\r\n//       })\r\n//       console.log(params);\r\n//       try {\r\n//         let res = services.putRequest(services.requestList.addFlow, params);\r\n//         if (isDataExist(res)) {\r\n//           return res;\r\n//         }\r\n//       } catch (error) {\r\n//         console.log(error);\r\n//       }\r\n//     }\r\n//   }, [reactFlowInstance]);\r\n\r\n//   const onNodeClick = useCallback((event, node) => {\r\n//     setNodeId(node.id)\r\n//     setPerArr(node.data.person)\r\n//     setNodeName(node.data.label)\r\n//   }, [nodeName], [nodeId])\r\n\r\n//   const handleChange = (value) => {\r\n//     setPerArr(value);\r\n//     console.log(`selected ${value}`);\r\n//   }\r\n\r\n//   function checkChange(checkedValues, a) {\r\n//     fieldProp[a] = checkedValues\r\n//   }\r\n//   return (\r\n//     <Layout>\r\n//       <Header className='header'>\r\n//         <Button type=\"primary\" className='save' onClick={onSave}>保存</Button>\r\n//       </Header>\r\n//       <Layout>\r\n//         <Content>\r\n//           <Layout>\r\n//             <Header className='title'>\r\n//               <Sidebar />\r\n//             </Header>\r\n//             <Content>\r\n//               <div className=\"dndflow\">\r\n//                 <ReactFlowProvider>\r\n//                   <Content>\r\n//                     <div className=\"reactflow-wrapper\" ref={reactFlowWrapper}>\r\n//                       <ReactFlow\r\n//                         nodes={nodes}\r\n//                         edges={edges}\r\n//                         onNodesChange={onNodesChange}\r\n//                         onEdgesChange={onEdgesChange}\r\n//                         onConnect={onConnect}\r\n//                         onInit={setReactFlowInstance}\r\n//                         onDrop={onDrop}\r\n//                         onDragOver={onDragOver}\r\n//                         nodeTypes={nodeTypes}\r\n//                         onNodeClick={onNodeClick}\r\n//                         fitView\r\n//                       >\r\n//                         <Controls />\r\n//                         <MiniMap />\r\n//                       </ReactFlow>\r\n//                     </div>\r\n//                   </Content>\r\n//                 </ReactFlowProvider>\r\n//               </div>\r\n//             </Content>\r\n//           </Layout>\r\n//         </Content>\r\n//         <Sider style={{ backgroundColor: 'white' }} width='300'>\r\n//           <div className=\"updatenode__controls\">\r\n//             <div>\r\n//               <label>节点名:</label>\r\n//               <input value={nodeName} onChange={(evt) => setNodeName(evt.target.value)} />\r\n//             </div>\r\n//             <div>\r\n//               <label>负责人：</label>\r\n//               <Select\r\n//                 // mode=\"multiple\"\r\n//                 allowClear\r\n//                 style={{ width: '80%', marginTop: '10px' }}\r\n//                 placeholder=\"Please select\"\r\n//                 value={perArr}\r\n//                 onChange={handleChange}\r\n//               >\r\n//                 {children}\r\n//               </Select>\r\n//             </div>\r\n//             {\r\n//               field.map((item) => {\r\n//                 return <div className='dataInfo'>\r\n//                   <label>{item.name}:</label>\r\n//                   <Checkbox.Group name={item.propertyId} options={[{ label: '可见', value: 'vis' }, { label: '可编辑', value: 'edit' }]} onChange={(checkedValues) => checkChange(checkedValues, item.propertyId)}></Checkbox.Group>\r\n//                 </div>\r\n//               })\r\n//             }\r\n//           </div>\r\n//         </Sider>\r\n//       </Layout>\r\n\r\n//     </Layout>\r\n\r\n//   );\r\n// };\r\n\r\nconst DnDFlow = ({ HomeStore }) => {\r\n  const reactFlowWrapper = useRef(null);\r\n  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);\r\n  const [perArr, setPerArr] = useState([]);\r\n  const [reactFlowInstance, setReactFlowInstance] = useState(null);\r\n  const [nodeName, setNodeName] = useState('');\r\n  const [nodeId, setNodeId] = useState('');\r\n  const [person, setPerson] = useState({});\r\n  const [children, setChildren] = useState([])\r\n\r\n  const field = [];\r\n  let fieldProp = {};\r\n  field.map((item) => {\r\n    fieldProp[item.propertyId] = []\r\n  })\r\n  useEffect(() => {\r\n    console.log(HomeStore.firstFormId);\r\n    let personList = Object.assign({}, props.location.state.PersonListT)\r\n    console.log(person);\r\n    let newC = []\r\n    Object.keys(personList).map((item) => {\r\n      if (personList[item] != undefined) {\r\n        newC.push(<Option key={personList[item].id}>{personList[item].nickName}</Option>)\r\n      }\r\n    })\r\n    setPerson(personList);\r\n    setChildren(newC);\r\n  }, [])\r\n  useEffect(() => {\r\n    setNodes((nds) =>\r\n      nds.map((node) => {\r\n        if (node.id === nodeId) {\r\n          // it's important that you create a new object here\r\n          // in order to notify react flow about the change\r\n          node.data = {\r\n            ...node.data,\r\n            label: nodeName,\r\n            person: perArr\r\n          };\r\n        }\r\n        return node;\r\n      })\r\n    );\r\n  }, [nodeName, setNodeName, perArr, setPerArr]);\r\n\r\n  const onConnect = useCallback((params) => {\r\n    let obj = {\r\n      type: MarkerType.Arrow,\r\n    }\r\n    params.markerEnd = obj\r\n    setEdges((eds) => addEdge(params, eds))\r\n  }, []);\r\n\r\n  const onDragOver = useCallback((event) => {\r\n    event.preventDefault();\r\n    event.dataTransfer.dropEffect = 'move';\r\n  }, []);\r\n\r\n  const onDrop = useCallback(\r\n    (event) => {\r\n      event.preventDefault();\r\n\r\n      const reactFlowBounds = reactFlowWrapper.current.getBoundingClientRect();\r\n      const type = event.dataTransfer.getData('application/reactflow');\r\n\r\n      // check if the dropped element is valid\r\n      if (typeof type === 'undefined' || !type) {\r\n        return;\r\n      }\r\n\r\n      const position = reactFlowInstance.project({\r\n        x: event.clientX - reactFlowBounds.left,\r\n        y: event.clientY - reactFlowBounds.top,\r\n      });\r\n      const newNode = {\r\n        id: getId(),\r\n        type,\r\n        position,\r\n        data: { label: `${type} node` },\r\n      };\r\n\r\n      setNodes((nds) => nds.concat(newNode));\r\n    },\r\n    [reactFlowInstance]\r\n  );\r\n\r\n  const onSave = useCallback(() => {\r\n    if (reactFlowInstance) {\r\n      const flow = reactFlowInstance.toObject();\r\n      // personList = Object.assign({},props.location.state.PersonListT)\r\n      let params = {}\r\n      params.firstFormId = props.location.state.firstFormId;\r\n      params.edges = flow.edges\r\n      params.nodes = []\r\n      flow.nodes.map((item) => {\r\n        let obj = {}\r\n        obj.id = item.id\r\n        obj.type = item.type\r\n        obj.position = item.position\r\n        obj.positionAbsolute = item.positionAbsolute\r\n        if (item.data.person != undefined && item.data.person.length != 0) {\r\n          let person1 = person[Number(item.data.person) - 1]\r\n          item.data.principal = person1['username'];\r\n          item.data.userId = person1['id'];\r\n        }\r\n        obj.data = item.data\r\n        params.nodes.push(obj)\r\n      })\r\n      console.log(params);\r\n      try {\r\n        let res = services.putRequest(services.requestList.addFlow, params);\r\n        if (isDataExist(res)) {\r\n          return res;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n  }, [reactFlowInstance]);\r\n\r\n  const onNodeClick = useCallback((event, node) => {\r\n    setNodeId(node.id)\r\n    setPerArr(node.data.person)\r\n    setNodeName(node.data.label)\r\n  }, [nodeName], [nodeId])\r\n\r\n  const handleChange = (value) => {\r\n    setPerArr(value);\r\n    console.log(`selected ${value}`);\r\n  }\r\n\r\n  function checkChange(checkedValues, a) {\r\n    fieldProp[a] = checkedValues\r\n  }\r\n  return (\r\n    <Layout>\r\n      <Header className='header'>\r\n        <Button type=\"primary\" className='save' onClick={onSave}>保存</Button>\r\n      </Header>\r\n      <Layout>\r\n        <Content>\r\n          <Layout>\r\n            <Header className='title'>\r\n              <Sidebar />\r\n            </Header>\r\n            <Content>\r\n              <div className=\"dndflow\">\r\n                <ReactFlowProvider>\r\n                  <Content>\r\n                    <div className=\"reactflow-wrapper\" ref={reactFlowWrapper}>\r\n                      <ReactFlow\r\n                        nodes={nodes}\r\n                        edges={edges}\r\n                        onNodesChange={onNodesChange}\r\n                        onEdgesChange={onEdgesChange}\r\n                        onConnect={onConnect}\r\n                        onInit={setReactFlowInstance}\r\n                        onDrop={onDrop}\r\n                        onDragOver={onDragOver}\r\n                        nodeTypes={nodeTypes}\r\n                        onNodeClick={onNodeClick}\r\n                        fitView\r\n                      >\r\n                        <Controls />\r\n                        <MiniMap />\r\n                      </ReactFlow>\r\n                    </div>\r\n                  </Content>\r\n                </ReactFlowProvider>\r\n              </div>\r\n            </Content>\r\n          </Layout>\r\n        </Content>\r\n        <Sider style={{ backgroundColor: 'white' }} width='300'>\r\n          <div className=\"updatenode__controls\">\r\n            <div>\r\n              <label>节点名:</label>\r\n              <input value={nodeName} onChange={(evt) => setNodeName(evt.target.value)} />\r\n            </div>\r\n            <div>\r\n              <label>负责人：</label>\r\n              <Select\r\n                // mode=\"multiple\"\r\n                allowClear\r\n                style={{ width: '80%', marginTop: '10px' }}\r\n                placeholder=\"Please select\"\r\n                value={perArr}\r\n                onChange={handleChange}\r\n              >\r\n                {children}\r\n              </Select>\r\n            </div>\r\n            {\r\n              field.map((item) => {\r\n                return <div className='dataInfo'>\r\n                  <label>{item.name}:</label>\r\n                  <Checkbox.Group name={item.propertyId} options={[{ label: '可见', value: 'vis' }, { label: '可编辑', value: 'edit' }]} onChange={(checkedValues) => checkChange(checkedValues, item.propertyId)}></Checkbox.Group>\r\n                </div>\r\n              })\r\n            }\r\n          </div>\r\n        </Sider>\r\n      </Layout>\r\n\r\n    </Layout>\r\n\r\n  );\r\n}\r\n\r\nexport default inject('HomeStore')(observer(DnDFlow));\r\n"],"mappings":";;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,MAA1B,EAAkCC,WAAlC,EAA+CC,OAA/C,EAAwDC,SAAxD,QAAyE,OAAzE;AAEA,OAAOC,SAAP,IACEC,iBADF,EAEEC,OAFF,EAGEC,aAHF,EAIEC,aAJF,EAKEC,QALF,EAMEC,OANF,EAOEC,UAPF,QAQO,qBARP;AASA,OAAO,KAAKC,QAAZ,MAA0B,uBAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AACA,OAAOC,OAAP,MAAoB,gBAApB;AAEA,OAAO,aAAP;AACA,SAASC,WAAT,QAA4B,iBAA5B;AACA,SAASC,UAAT,QAA2B,MAA3B;AACA,SAASC,MAAT,EAAiBC,QAAjB,QAAiC,YAAjC;AAEA,IAAQC,MAAR,WAAQA,MAAR;AAAA,IAAgBC,KAAhB,WAAgBA,KAAhB;AAAA,IAAuBC,OAAvB,WAAuBA,OAAvB;AACA,IAAQC,MAAR,WAAQA,MAAR;AACA,IAAMC,YAAY,GAAG,CACnB;EACE,MAAM,GADR;EAEE,QAAQ,OAFV;EAGE,QAAQ;IACN,SAAS,MADH;IAEN,UAAU;EAFJ,CAHV;EAOE,YAAY;IACV,KAAK,GADK;IAEV,KAAK,CAAC;EAFI,CAPd;EAWE,oBAAoB;IAClB,KAAK,GADa;IAElB,KAAK,CAAC;EAFY;AAXtB,CADmB,EAiBnB;EACE,MAAM,IADR;EAEE,QAAQ,KAFV;EAGE,QAAQ;IACN,SAAS,MADH;IAEN,UAAU;EAFJ,CAHV;EAQE,YAAY;IACV,KAAK,GADK;IAEV,KAAK;EAFK,CARd;EAYE,oBAAoB;IAClB,KAAK,GADa;IAElB,KAAK;EAFa;AAZtB,CAjBmB,EAkCnB;EACE,MAAM,QADR;EAEE,QAAQ,UAFV;EAGE,YAAY;IACV,KAAK,MADK;IAEV,KAAK;EAFK,CAHd;EAOE,QAAQ;IACN,SAAS,eADH;IAEN,UAAU;EAFJ,CAPV;EAWE,oBAAoB;IAClB,KAAK,MADa;IAElB,KAAK;EAFa;AAXtB,CAlCmB,CAArB;AAmDA,IAAMC,YAAY,GAAG,CACnB;EACE,UAAU,GADZ;EAEE,gBAAgB,IAFlB;EAGE,UAAU,QAHZ;EAIE,gBAAgB,KAJlB;EAKE,aAAa;IACX,QAAQ;EADG,CALf;EAQE,MAAM;AARR,CADmB,EAWnB;EACE,UAAU,QADZ;EAEE,gBAAgB,QAFlB;EAGE,UAAU,IAHZ;EAIE,gBAAgB,IAJlB;EAKE,aAAa;IACX,QAAQ;EADG,CALf;EAQE,MAAM;AARR,CAXmB,CAArB;AAsBA,IAAMC,SAAS,GAAG;EAAEb,QAAQ,EAAEA,QAAZ;EAAsBC,QAAQ,EAAEA,QAAhC;EAA0Ca,GAAG,EAAEZ;AAA/C,CAAlB;AAEA,IAAIa,EAAE,GAAG,CAAT;;AACA,IAAMC,KAAK,GAAG,SAARA,KAAQ;EAAA,sBAAc,EAAED,EAAhB;AAAA,CAAd,C,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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"},"metadata":{},"sourceType":"module"}