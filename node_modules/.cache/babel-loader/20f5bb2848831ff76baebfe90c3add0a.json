{"ast":null,"code":"/*\r\n * @Author: EmberCCC 1810888456@qq.com\r\n * @Date: 2022-07-05 10:16:45\r\n * @LastEditors: EmberCCC 1810888456@qq.com\r\n * @LastEditTime: 2022-07-18 00:18:22\r\n * @FilePath: \\bl-device-manage-test\\src\\layouts\\FormEdit\\changeTool.js\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\nimport { firstFormName } from \"constants/status_constant\";\nimport { nanoid } from \"nanoid\";\nexport function exChange(item, firstFormId) {\n  var params = {};\n  var pro = {};\n  var subForms = [];\n  params.formId = firstFormId;\n  params.formName = firstFormName[firstFormId];\n\n  for (var key in item) {\n    if (key != 'properties') {\n      pro[key] = item[key];\n    } else {\n      var field = [];\n      var obj = {};\n      obj['name'] = 'root';\n\n      for (var keyP in item[key]) {\n        var iObj = {};\n        iObj['name'] = keyP;\n        iObj['detailJson'] = item[key][keyP];\n\n        if (iObj['detailJson'].hasOwnProperty('fieldId')) {\n          iObj['fieldId'] = iObj['detailJson']['fieldId'];\n        }\n\n        if (!iObj['detailJson'].hasOwnProperty('typeId')) {\n          iObj['detailJson']['typeId'] = keyP.split('_')[0];\n        }\n\n        iObj['typeId'] = iObj['detailJson']['typeId'];\n        iObj['name'] = iObj['detailJson']['title'];\n        console.log(iObj);\n        field.push(iObj);\n      }\n\n      obj['fields'] = field;\n      subForms.push(obj);\n    }\n  }\n\n  params['properties'] = pro;\n  params['subForms'] = subForms;\n  return params;\n}\n\nfunction getOneForm(fields, fieldIds, type) {\n  console.log(fields);\n  var result = {};\n  fieldIds.forEach(function (item) {\n    fields.forEach(function (field) {\n      if (field['id'] == item) {\n        var detailJson = JSON.parse(field['detailJson']);\n        console.log(detailJson);\n        var name = type == 'submit' ? detailJson['fieldId'] : \"\".concat(detailJson['typeId'], \"_\").concat(nanoid(6));\n        result[name] = detailJson;\n        result[name]['fieldId'] = field['id'];\n      }\n    });\n  });\n  console.log(result);\n  return result;\n}\n\nexport function restore(obj, type) {\n  var formArr = {};\n  var fieldInfo;\n  var properties;\n\n  if (obj.hasOwnProperty('form') && obj['form'].hasOwnProperty('formFields')) {\n    fieldInfo = JSON.parse(obj['form']['formFields']);\n    properties = JSON.parse(obj['form']['properties']);\n    var fields = obj['fields'];\n\n    for (var index = 0; index < fieldInfo.length; index++) {\n      var formItem = {};\n      var element = fieldInfo[index];\n      formItem['properties'] = getOneForm(fields, element['fieldsId'], type);\n\n      for (var key in properties) {\n        if (Object.hasOwnProperty.call(properties, key)) {\n          var _element = properties[key];\n          formItem[key] = _element;\n        }\n      }\n\n      formArr[fieldInfo[index]['name']] = formItem;\n    }\n  }\n\n  return formArr;\n}\nexport function getSchema(columnsArr) {\n  var schema = {};\n  schema['type'] = 'object';\n  var properties = {};\n  columnsArr.map(function (item) {\n    if (!['createPerson', 'createTime', 'updateTime'].includes(item['key'])) {\n      properties[item['key']] = item['detailJson'];\n    }\n  });\n  schema['labelWidth'] = 30;\n  schema['properties'] = properties;\n  console.log(schema);\n  return schema;\n}","map":{"version":3,"names":["firstFormName","nanoid","exChange","item","firstFormId","params","pro","subForms","formId","formName","key","field","obj","keyP","iObj","hasOwnProperty","split","console","log","push","getOneForm","fields","fieldIds","type","result","forEach","detailJson","JSON","parse","name","concat","restore","formArr","fieldInfo","properties","index","length","formItem","element","Object","call","getSchema","columnsArr","schema","map","includes"],"sources":["F:/documents/bl-device-manage-test/src/layouts/FormEdit/changeTool.js"],"sourcesContent":["/*\r\n * @Author: EmberCCC 1810888456@qq.com\r\n * @Date: 2022-07-05 10:16:45\r\n * @LastEditors: EmberCCC 1810888456@qq.com\r\n * @LastEditTime: 2022-07-18 00:18:22\r\n * @FilePath: \\bl-device-manage-test\\src\\layouts\\FormEdit\\changeTool.js\r\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nimport { firstFormName } from \"constants/status_constant\";\r\nimport { nanoid } from \"nanoid\";\r\n\r\nexport function exChange(item, firstFormId) {\r\n  let params = {};\r\n  let pro = {};\r\n  let subForms = [];\r\n  params.formId = firstFormId;\r\n  params.formName = firstFormName[firstFormId]\r\n  for (const key in item) {\r\n    if (key != 'properties') {\r\n      pro[key] = item[key];\r\n    } else {\r\n      let field = [];\r\n      let obj = {};\r\n      obj['name'] = 'root';\r\n      for (const keyP in item[key]) {\r\n        let iObj = {};\r\n        iObj['name'] = keyP\r\n\r\n        iObj['detailJson'] = item[key][keyP]\r\n        if (iObj['detailJson'].hasOwnProperty('fieldId')) {\r\n          iObj['fieldId'] = iObj['detailJson']['fieldId'];\r\n        }\r\n        if (!iObj['detailJson'].hasOwnProperty('typeId')) {\r\n          iObj['detailJson']['typeId'] = keyP.split('_')[0];\r\n        }\r\n        iObj['typeId'] = iObj['detailJson']['typeId']\r\n        iObj['name'] = iObj['detailJson']['title']\r\n        console.log(iObj);\r\n        field.push(iObj);\r\n      }\r\n      obj['fields'] = field\r\n      subForms.push(obj)\r\n    }\r\n  }\r\n  params['properties'] = pro\r\n  params['subForms'] = subForms\r\n  return params;\r\n}\r\n\r\nfunction getOneForm(fields, fieldIds, type) {\r\n  console.log(fields);\r\n  let result = {}\r\n  fieldIds.forEach(item => {\r\n    fields.forEach(field => {\r\n      if (field['id'] == item) {\r\n        const detailJson = JSON.parse(field['detailJson']);\r\n        console.log(detailJson);\r\n        const name = type == 'submit' ? detailJson['fieldId'] : \"\".concat(detailJson['typeId'], \"_\").concat(nanoid(6))\r\n        result[name] = detailJson;\r\n        result[name]['fieldId'] = field['id'];\r\n      }\r\n    });\r\n  });\r\n  console.log(result);\r\n  return result\r\n}\r\nexport function restore(obj, type) {\r\n  let formArr = {}\r\n  let fieldInfo;\r\n  let properties;\r\n  if (obj.hasOwnProperty('form') && obj['form'].hasOwnProperty('formFields')) {\r\n    fieldInfo = JSON.parse(obj['form']['formFields']);\r\n    properties = JSON.parse(obj['form']['properties']);\r\n    const fields = obj['fields'];\r\n    for (let index = 0; index < fieldInfo.length; index++) {\r\n      let formItem = {}\r\n      const element = fieldInfo[index];\r\n      formItem['properties'] = getOneForm(fields, element['fieldsId'], type)\r\n      for (const key in properties) {\r\n        if (Object.hasOwnProperty.call(properties, key)) {\r\n          const element = properties[key];\r\n          formItem[key] = element\r\n        }\r\n      }\r\n      formArr[fieldInfo[index]['name']] = formItem;\r\n    }\r\n  }\r\n\r\n\r\n  return formArr;\r\n}\r\n\r\nexport function getSchema(columnsArr) {\r\n  let schema = {}\r\n  schema['type'] = 'object'\r\n  let properties = {}\r\n  columnsArr.map((item) => {\r\n    if (!['createPerson', 'createTime', 'updateTime'].includes(item['key'])) {\r\n      properties[item['key']] = item['detailJson']\r\n    }\r\n  })\r\n  schema['labelWidth'] = 30\r\n  schema['properties'] = properties;\r\n  console.log(schema);\r\n  return schema\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}