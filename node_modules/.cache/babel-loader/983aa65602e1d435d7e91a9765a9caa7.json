{"ast":null,"code":"import 'antd/es/config-provider/style';\nimport _ConfigProvider from 'antd/es/config-provider';\nimport zh_CN from 'antd/lib/locale/zh_CN';\nimport SearchForm, { useForm } from 'form-render';\nimport _get from 'lodash.get';\nimport React, { createContext, useContext, useReducer, forwardRef, useImperativeHandle, useRef, useState, useEffect } from 'react';\nimport 'antd/es/button/style';\nimport _Button from 'antd/es/button';\nimport 'antd/es/radio/style';\nimport _Radio from 'antd/es/radio';\nimport 'antd/es/table/style';\nimport _Table from 'antd/es/table';\nimport 'antd/es/space/style';\nimport _Space from 'antd/es/space';\nimport dayjs from 'dayjs';\nimport 'antd/es/result/style';\nimport _Result from 'antd/es/result';\nimport 'antd/es/message/style';\nimport _message from 'antd/es/message';\nimport 'antd/es/typography/style';\nimport _Typography from 'antd/es/typography';\nimport 'antd/es/tooltip/style';\nimport _Tooltip from 'antd/es/tooltip';\nimport _ColumnHeightOutlined from '@ant-design/icons/lib/icons/ColumnHeightOutlined';\nimport 'antd/es/menu/style';\nimport _Menu from 'antd/es/menu';\nimport 'antd/es/dropdown/style';\nimport _Dropdown from 'antd/es/dropdown';\nimport _FullscreenOutlined from '@ant-design/icons/lib/icons/FullscreenOutlined';\nimport _FullscreenExitOutlined from '@ant-design/icons/lib/icons/FullscreenExitOutlined';\nimport _ReloadOutlined from '@ant-design/icons/lib/icons/ReloadOutlined';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar Ctx = /*#__PURE__*/createContext({});\n\nvar useTable = function useTable() {\n  return useContext(Ctx);\n}; // 组件最顶层传入的所有props\n\n\nvar useSet = function useSet(initState) {\n  var _useReducer = useReducer(function (state, newState) {\n    var action = newState;\n\n    if (typeof newState === 'function') {\n      action = action(state);\n    }\n\n    if (newState.action && newState.payload) {\n      action = newState.payload;\n\n      if (typeof action === 'function') {\n        action = action(state);\n      }\n    }\n\n    var result = _objectSpread2(_objectSpread2({}, state), action);\n\n    return result;\n  }, initState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      setState = _useReducer2[1];\n\n  var setStateWithActionName = function setStateWithActionName(state, actionName) {\n    setState(state);\n  };\n\n  return [state, setStateWithActionName];\n};\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".tr-search {\\n  width: 100%;\\n  background: #fff;\\n  padding: 24px 24px 0;\\n  margin-bottom: 16px;\\n}\\n.tr-search .search-btn {\\n  flex: 1;\\n}\\n\\n.tr-table-wrapper {\\n  background: #fff;\\n  padding: 0 24px 24px;\\n  width: 100%;\\n  overflow: auto;\\n}\\n\\n.tr-table-top {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  height: 64px;\\n}\\n\\n.tr-table-top-nohead {\\n  height: 24px;\\n}\\n\\n.tr-action-list {\\n  display: flex;\\n  justify-content: center;\\n}\\n\\n.tr-single-tab {\\n  color: rgba(0, 0, 0, 0.85);\\n  font-size: 16px;\\n  font-weight: 500;\\n  line-height: 24px;\\n  opacity: 0.85;\\n}\\n\\n.tr-extra-tab {\\n  display: inline-block;\\n  margin-left: 16px;\\n}\\n\\n.tr-search-btn.fr-field {\\n  padding-right: 0;\\n}\\n\\n.mb2 {\\n  margin-bottom: 0.5rem;\\n}\\n\\n.mr {\\n  margin-right: 8px;\\n}\\n\\n.flex {\\n  display: flex;\\n}\\n\\n.justify-end {\\n  justify-content: flex-end;\\n}\\n\\n.w-100 {\\n  width: 100%;\\n}\\n\";\nstyleInject(css_248z);\nvar _excluded = [\"current\", \"pageSize\", \"tab\", \"sorter\"],\n    _excluded2 = [\"rows\", \"total\", \"pageSize\"];\n\nvar useTableRoot = function useTableRoot(props) {\n  var form = useForm();\n\n  var _useSet = useSet({\n    loading: false,\n    api: null,\n    tab: 0,\n    dataSource: [],\n    extraData: null,\n    extraParams: {},\n    pagination: {\n      current: 1,\n      pageSize: 10,\n      total: 1\n    },\n    tableSize: 'default'\n  }),\n      _useSet2 = _slicedToArray(_useSet, 2),\n      state = _useSet2[0],\n      set = _useSet2[1];\n\n  var api = useRef();\n  var afterSearch = useRef();\n  var pagination = state.pagination,\n      currentTab = state.tab;\n\n  var doSearch = function doSearch(params, customSearch) {\n    var _ref = params || {},\n        current = _ref.current,\n        pageSize = _ref.pageSize,\n        tab = _ref.tab,\n        sorter = _ref.sorter,\n        extraSearch = _objectWithoutProperties(_ref, _excluded);\n\n    var _current = current || 1;\n\n    var _pageSize = pageSize || 10;\n\n    var _tab = currentTab;\n\n    if (['string', 'number'].indexOf(_typeof(tab)) > -1) {\n      _tab = tab;\n    }\n\n    var _pagination = {\n      current: _current,\n      pageSize: _pageSize\n    };\n\n    if (typeof api.current === 'function') {\n      basicSearch(api.current);\n    } else if (Array.isArray(api.current)) {\n      var _api = _get(api.current, \"[\".concat(_tab, \"].api\"));\n\n      if (typeof _api === 'function') {\n        basicSearch(_api);\n      } else {\n        console.warn('api 不是函数，检查 <Search /> 的 props');\n      }\n    } else {\n      console.warn('api 不是函数，检查 <Search /> 的 props');\n    }\n\n    function basicSearch(api) {\n      set({\n        loading: true\n      });\n\n      var _params = _objectSpread2(_objectSpread2(_objectSpread2(_objectSpread2({}, form.getValues()), customSearch), extraSearch), _pagination);\n\n      if (Array.isArray(api)) {\n        _params = _objectSpread2(_objectSpread2({}, _params), {}, {\n          tab: tab\n        });\n      }\n\n      Promise.resolve(api(_params, sorter)).then(function (res) {\n        // TODO：这里校验res是否规范\n        var rows = res.rows,\n            total = res.total,\n            pageSize = res.pageSize,\n            extraData = _objectWithoutProperties(res, _excluded2);\n\n        set(_objectSpread2(_objectSpread2({\n          loading: false,\n          dataSource: rows\n        }, extraData), {}, {\n          pagination: _objectSpread2(_objectSpread2({}, _pagination), {}, {\n            total: total,\n            pageSize: pageSize || _pageSize\n          })\n        }));\n        afterSearch.current(_objectSpread2({\n          rows: rows,\n          total: total,\n          pageSize: pageSize\n        }, extraData));\n      }).catch(function (err) {\n        set({\n          loading: false\n        });\n      });\n    }\n  };\n\n  var refresh = function refresh(params, moreSearch) {\n    var _stay = params && params.stay || false;\n\n    var _tab = params && params.tab;\n\n    var _search = moreSearch || {};\n\n    doSearch(_objectSpread2(_objectSpread2({}, params), {}, {\n      current: _stay ? pagination.current : 1,\n      tab: _tab,\n      pageSize: pagination.pageSize\n    }), _search);\n  };\n\n  var changeTab = function changeTab(tab) {\n    if (['string', 'number'].indexOf(_typeof(tab)) > -1) {\n      set({\n        tab: tab\n      });\n      refresh({\n        tab: tab\n      });\n    } else {\n      console.error('changeTab的入参必须是number或string');\n    }\n  };\n\n  var syncMethods = function syncMethods(_ref2) {\n    var searchApi = _ref2.searchApi,\n        syncAfterSearch = _ref2.syncAfterSearch;\n    api.current = searchApi;\n    afterSearch.current = syncAfterSearch;\n    set({\n      api: searchApi\n    });\n  };\n\n  var context = {\n    tableState: _objectSpread2(_objectSpread2({}, state), {}, {\n      search: form.getValues()\n    }),\n    setTable: set,\n    doSearch: doSearch,\n    refresh: refresh,\n    changeTab: changeTab,\n    syncMethods: syncMethods,\n    form: form\n  };\n  return context;\n};\n\nvar Container = function Container(props, ref) {\n  var context = useTableRoot();\n  useImperativeHandle(ref, function () {\n    return context;\n  });\n  return /*#__PURE__*/React.createElement(_ConfigProvider, {\n    locale: zh_CN\n  }, /*#__PURE__*/React.createElement(Ctx.Provider, _objectSpread2(_objectSpread2({}, props), {}, {\n    value: context\n  })));\n};\n\nvar TableProvider = /*#__PURE__*/forwardRef(Container);\n\nvar withTable = function withTable(Component) {\n  return function (props) {\n    return /*#__PURE__*/React.createElement(TableProvider, null, /*#__PURE__*/React.createElement(Component, _objectSpread2({}, props)));\n  };\n};\n\nvar _excluded$1 = [\"clearSearch\", \"submit\", \"style\", \"className\"],\n    _excluded2$1 = [\"searchBtnRender\", \"searchBtnStyle\", \"searchBtnClassName\", \"form\"];\n\nvar SearchBtn = function SearchBtn(_ref) {\n  var clearSearch = _ref.clearSearch,\n      submit = _ref.submit,\n      _ref$style = _ref.style,\n      style = _ref$style === void 0 ? {} : _ref$style,\n      _ref$className = _ref.className,\n      className = _ref$className === void 0 ? '' : _ref$className,\n      rest = _objectWithoutProperties(_ref, _excluded$1);\n\n  var _useTable = useTable(),\n      _useTable$tableState = _useTable.tableState,\n      tableState = _useTable$tableState === void 0 ? {} : _useTable$tableState;\n\n  var loading = tableState.loading;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex justify-end w-100 \".concat(className),\n    style: style\n  }, /*#__PURE__*/React.createElement(_Button, {\n    loading: loading,\n    className: \"mr\",\n    type: \"primary\",\n    onClick: submit\n  }, rest.searchText), /*#__PURE__*/React.createElement(_Button, {\n    onClick: clearSearch\n  }, rest.resetText));\n};\n\nvar MySearchBtn = function MySearchBtn(_ref2) {\n  var searchBtnRender = _ref2.searchBtnRender,\n      searchBtnStyle = _ref2.searchBtnStyle,\n      searchBtnClassName = _ref2.searchBtnClassName,\n      form = _ref2.form,\n      rest = _objectWithoutProperties(_ref2, _excluded2$1);\n\n  var clearSearch = function clearSearch() {\n    form.resetFields();\n    form.submit();\n  };\n\n  var searchBtnArr = typeof searchBtnRender === 'function' ? searchBtnRender(form.submit, clearSearch) : [];\n\n  if (searchBtnRender) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex justify-end w-100\"\n    }, Array.isArray(searchBtnArr) && searchBtnArr.map(function (ui, idx) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: idx.toString(),\n        style: {\n          marginLeft: 8\n        }\n      }, ui);\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(SearchBtn, _objectSpread2({\n    submit: form.submit,\n    clearSearch: clearSearch,\n    style: searchBtnStyle || {},\n    className: searchBtnClassName || ''\n  }, rest));\n};\n\nvar Search = function Search(props) {\n  var searchBtnRender = props.searchBtnRender,\n      searchBtnStyle = props.searchBtnStyle,\n      searchBtnClassName = props.searchBtnClassName,\n      _props$searchText = props.searchText,\n      searchText = _props$searchText === void 0 ? '查询' : _props$searchText,\n      _props$resetText = props.resetText,\n      resetText = _props$resetText === void 0 ? '重置' : _props$resetText,\n      _props$searchWithErro = props.searchWithError,\n      searchWithError = _props$searchWithErro === void 0 ? true : _props$searchWithErro,\n      _props$style = props.style,\n      style = _props$style === void 0 ? {} : _props$style;\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      formSchema = _useState2[0],\n      setSchema = _useState2[1];\n\n  var _useTable2 = useTable(),\n      refresh = _useTable2.refresh,\n      syncMethods = _useTable2.syncMethods,\n      setTable = _useTable2.setTable,\n      form = _useTable2.form,\n      tableState = _useTable2.tableState;\n\n  var _schema = props.schema || props.propsSchema;\n\n  var searchOnMount = true;\n\n  if (!props.searchOnMount && props.searchOnMount !== undefined) {\n    searchOnMount = false;\n  }\n\n  var modifiedSchema = useRef(); // 给schema里拼接一个buttons\n\n  var modifySchema = function modifySchema() {\n    var noDiff = JSON.stringify(modifiedSchema.current) === JSON.stringify(_schema);\n\n    if (_schema && _schema.properties) {\n      if (formSchema && noDiff) return;\n\n      try {\n        var curSchema = JSON.parse(JSON.stringify(_schema));\n        curSchema.properties.searchBtn = {\n          type: 'string',\n          widget: 'searchBtn',\n          className: 'search-btn',\n          bind: false // width: calcWidth(_schema),\n\n        };\n        setSchema(curSchema);\n      } catch (error) {\n        console.error(error);\n      }\n    } else {\n      console.error('SearchForm 传入了不正确的 schema，参考文档: https://xrender.fun/form-render/form-render/config/schema');\n    }\n  };\n\n  useEffect(function () {\n    if (!props.hidden) {\n      modifySchema();\n    }\n  }, [_schema]);\n  useEffect(function () {\n    syncMethods({\n      searchApi: props.api,\n      syncAfterSearch: props.afterSearch\n    });\n\n    if (!props.hidden && searchOnMount) {\n      form.submit();\n    } // 隐藏search组件时，不会触发form.submit\n\n\n    if (props.hidden) {\n      refresh();\n    }\n  }, []);\n  var btnProps = {\n    searchBtnRender: searchBtnRender,\n    searchBtnStyle: searchBtnStyle,\n    searchBtnClassName: searchBtnClassName,\n    searchText: searchText,\n    resetText: resetText,\n    form: form\n  };\n  if (props.hidden) return null;\n\n  var onFinish = function onFinish(data, errors) {\n    if (!searchWithError && (errors === null || errors === void 0 ? void 0 : errors.length) > 0) {\n      return;\n    }\n\n    if (typeof props.onSearch === 'function') {\n      props.onSearch(data);\n    }\n\n    refresh(_objectSpread2(_objectSpread2({}, data), {}, {\n      sorter: tableState === null || tableState === void 0 ? void 0 : tableState.sorter\n    }));\n  };\n\n  var searchFormProps = _objectSpread2(_objectSpread2({\n    displayType: 'row',\n    onFinish: onFinish\n  }, props), {}, {\n    form: form,\n    schema: formSchema,\n    widgets: _objectSpread2({\n      searchBtn: function searchBtn() {\n        return /*#__PURE__*/React.createElement(MySearchBtn, _objectSpread2({}, btnProps));\n      }\n    }, props.widgets)\n  });\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"tr-search \".concat(props.className),\n    style: style,\n    onKeyDown: function onKeyDown(e) {\n      if (e.keyCode === 13) {\n        form.submit();\n      }\n    }\n  }, /*#__PURE__*/React.createElement(SearchForm, _objectSpread2({}, searchFormProps)));\n};\n\nvar getDateTime = function getDateTime(time) {\n  if (!time) return null;\n  return dayjs(time).format('YYYY-MM-DD HH:mm');\n};\n\nvar getDate = function getDate(time) {\n  if (!time) return null;\n  return dayjs(time).format('YYYY-MM-DD');\n}; // 格式化千分符\n\n\nvar getMoneyType = function getMoneyType(num) {\n  if (!num) return null;\n  return \"\\xA5\".concat(num).replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1,');\n}; // 如果是函数，则解析，如果不是，直接返回值\n\n\nvar ErrorBoundary = /*#__PURE__*/function (_React$Component) {\n  _inherits(ErrorBoundary, _React$Component);\n\n  var _super = _createSuper(ErrorBoundary);\n\n  function ErrorBoundary() {\n    var _this;\n\n    _classCallCheck(this, ErrorBoundary);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      hasError: false,\n      errorInfo: ''\n    };\n    return _this;\n  }\n\n  _createClass(ErrorBoundary, [{\n    key: \"componentDidCatch\",\n    value: function componentDidCatch(error, errorInfo) {\n      // eslint-disable-next-line no-console\n      console.log(error, errorInfo);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.hasError) {\n        // You can render any custom fallback UI\n        return /*#__PURE__*/React.createElement(_Result, {\n          status: \"error\",\n          title: \"Something went wrong.\",\n          extra: this.state.errorInfo\n        });\n      } //@ts-ignore\n\n\n      return this.props.children;\n    }\n  }], [{\n    key: \"getDerivedStateFromError\",\n    value: function getDerivedStateFromError(error) {\n      return {\n        hasError: true,\n        errorInfo: error.message\n      };\n    }\n  }]);\n\n  return ErrorBoundary;\n}(React.Component);\n\nvar renderEllipsis = function renderEllipsis(dom, text, item) {\n  if (!item.ellipsis) {\n    return /*#__PURE__*/React.createElement(\"span\", null, /*#__PURE__*/React.createElement(React.Fragment, null, dom));\n  }\n\n  return /*#__PURE__*/React.createElement(_Tooltip, {\n    title: getEnumValue(text, item)\n  }, dom);\n};\n\nvar renderCopyable = function renderCopyable(text, item) {\n  if (item.copyable || item.ellipsis) {\n    return /*#__PURE__*/React.createElement(_Typography.Text, {\n      style: {\n        maxWidth: '100%',\n        margin: 0,\n        padding: 0\n      },\n      copyable: item.copyable && text ? {\n        text: text,\n        onCopy: function onCopy() {\n          return _message.success('复制成功');\n        }\n      } : undefined,\n      ellipsis: item.ellipsis || false\n    }, getEnumValue(text, item));\n  }\n\n  return getEnumValue(text, item);\n};\n\nvar getEnumValue = function getEnumValue(text, item) {\n  var valueEnum = item.enum || undefined;\n  return valueEnum && valueEnum[text] ? valueEnum[text] : text;\n};\n\nvar renderCode = function renderCode(code) {\n  return code ? /*#__PURE__*/React.createElement(\"pre\", {\n    style: {\n      padding: 16,\n      overflow: 'auto',\n      fontSize: '85%',\n      lineHeight: 1.45,\n      backgroundColor: '#f6f8fa',\n      borderRadius: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"code\", {\n    style: {\n      whiteSpace: 'pre-wrap'\n    }\n  }, code)) : null;\n}; // 渲染单元格\n\n\nvar renderDom = function renderDom(val, item) {\n  if (_typeof(val) === 'object') {\n    return;\n  }\n\n  if (item.valueType === 'code') {\n    return renderCode(val);\n  }\n\n  var copyHoc = renderCopyable(val, item);\n  var ellipsisHoc = renderEllipsis(copyHoc, val, item);\n  return ellipsisHoc;\n};\n\nvar DesityIcon = function DesityIcon() {\n  var _useTable = useTable(),\n      tableState = _useTable.tableState,\n      setTable = _useTable.setTable;\n\n  var dropRef = useRef(); // class组件用 React.createRef()\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: dropRef\n  }, /*#__PURE__*/React.createElement(_Dropdown, {\n    getPopupContainer: function getPopupContainer() {\n      return dropRef.current;\n    },\n    overlay: /*#__PURE__*/React.createElement(_Menu, {\n      selectedKeys: [tableState.tableSize],\n      onClick: function onClick(_ref) {\n        var key = _ref.key;\n        setTable({\n          tableSize: key\n        });\n      },\n      style: {\n        width: 80\n      }\n    }, /*#__PURE__*/React.createElement(_Menu.Item, {\n      key: \"default\"\n    }, \"\\u9ED8\\u8BA4\"), /*#__PURE__*/React.createElement(_Menu.Item, {\n      key: \"middle\"\n    }, \"\\u4E2D\\u7B49\"), /*#__PURE__*/React.createElement(_Menu.Item, {\n      key: \"small\"\n    }, \"\\u7D27\\u51D1\")),\n    trigger: ['click']\n  }, /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u8868\\u683C\\u5BC6\\u5EA6\"\n  }, /*#__PURE__*/React.createElement(_ColumnHeightOutlined, null))));\n};\n\nvar FullScreenIcon = function FullScreenIcon(props) {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isFullScreen = _useState2[0],\n      setFullScreen = _useState2[1];\n\n  var fullScreen = props.fullScreen;\n  return isFullScreen ? /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u9000\\u51FA\\u5168\\u5C4F\"\n  }, /*#__PURE__*/React.createElement(_FullscreenExitOutlined, {\n    onClick: function onClick() {\n      document.exitFullscreen();\n      setFullScreen(false);\n    }\n  })) : /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u5168\\u5C4F\"\n  }, /*#__PURE__*/React.createElement(_FullscreenOutlined, {\n    onClick: function onClick() {\n      if (!document.fullscreenEnabled) {\n        _message.warning('当前页面不支持全屏功能');\n\n        return;\n      }\n\n      if (!document.fullscreenElement) {\n        setFullScreen(true);\n        fullScreen().catch(function (err) {\n          return _message.error(err.message);\n        });\n      }\n    }\n  }));\n};\n\nvar ReloadIcon = function ReloadIcon() {\n  var _useTable = useTable(),\n      refresh = _useTable.refresh;\n\n  return /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u5237\\u65B0\"\n  }, /*#__PURE__*/React.createElement(_ReloadOutlined, {\n    onClick: function onClick() {\n      return refresh();\n    }\n  }));\n};\n\nvar ToolBar = function ToolBar(props) {\n  return /*#__PURE__*/React.createElement(_Space, {\n    size: 14,\n    style: {\n      fontSize: 16,\n      cursor: 'pointer'\n    }\n  }, /*#__PURE__*/React.createElement(ReloadIcon, null), /*#__PURE__*/React.createElement(DesityIcon, null), /*#__PURE__*/React.createElement(FullScreenIcon, _objectSpread2({}, props)));\n};\n\nvar _excluded$2 = [\"title\"];\n\nvar ProTable = function ProTable(props) {\n  var _props$pagination, _props$pagination2, _props$pagination3; //@ts-ignore\n\n\n  if (props.dataSource) {\n    console.error('设置table-render的数据请使用api，具体使用可参考：https://form-render.github.io/table-render/guide/demo#%E5%9F%BA%E6%9C%AC-demo');\n  }\n\n  var _useTable = useTable(),\n      tableState = _useTable.tableState,\n      setTable = _useTable.setTable,\n      doSearch = _useTable.doSearch;\n\n  var dataSource = tableState.dataSource,\n      pagination = tableState.pagination,\n      loading = tableState.loading,\n      api = tableState.api,\n      tableSize = tableState.tableSize;\n  var rootRef = useRef(null); // ProTable组件的ref\n\n  var onChange = function onChange(_ref, filters, sorter) {\n    var current = _ref.current,\n        pageSize = _ref.pageSize;\n    setTable({\n      pagination: _objectSpread2(_objectSpread2({}, pagination), {}, {\n        current: current,\n        pageSize: pageSize\n      }),\n      sorter: sorter\n    });\n    if (!props.pageChangeWithRequest && props.pageChangeWithRequest !== undefined) return;\n    doSearch({\n      current: current,\n      pageSize: pageSize,\n      sorter: sorter\n    });\n  };\n\n  var debug = props.debug,\n      headerTitle = props.headerTitle,\n      toolbarRender = props.toolbarRender,\n      columns = props.columns,\n      _props$style = props.style,\n      style = _props$style === void 0 ? {} : _props$style,\n      _props$className = props.className,\n      className = _props$className === void 0 ? '' : _props$className,\n      _props$toolbarAction = props.toolbarAction,\n      toolbarAction = _props$toolbarAction === void 0 ? false : _props$toolbarAction;\n  columns.map(function (item) {\n    var result = item; // 用户在columns中自定义的render会覆盖tr的预设render\n\n    if (result.render) return result;\n\n    switch (result.valueType) {\n      case 'date':\n        result.render = function (value) {\n          return renderDom(getDate(value), result);\n        };\n\n        break;\n\n      case 'dateTime':\n        result.render = function (value) {\n          return renderDom(getDateTime(value), result);\n        };\n\n        break;\n\n      case 'money':\n        result.render = function (value) {\n          return renderDom(getMoneyType(value), result);\n        };\n\n        break;\n\n      case 'code':\n        result.render = function (value) {\n          return renderDom(value, result);\n        };\n\n        break;\n\n      case 'text':\n      default:\n        result.render = function (value) {\n          return renderDom(value, result);\n        };\n\n    }\n\n    return result;\n  });\n\n  var tableProps = _objectSpread2(_objectSpread2({}, props), {}, {\n    onChange: onChange,\n    // dataSource不准在使用ProTable时用props赋值\n    dataSource: dataSource,\n    pagination: props.pagination === false ? false : _objectSpread2(_objectSpread2({\n      // onChange: onPageChange,\n      size: 'small'\n    }, props.pagination), {}, {\n      pageSize: ((_props$pagination = props.pagination) === null || _props$pagination === void 0 ? void 0 : _props$pagination.pageSize) || pagination.pageSize,\n      total: ((_props$pagination2 = props.pagination) === null || _props$pagination2 === void 0 ? void 0 : _props$pagination2.total) || pagination.total,\n      current: ((_props$pagination3 = props.pagination) === null || _props$pagination3 === void 0 ? void 0 : _props$pagination3.current) || pagination.current\n    }),\n    loading: loading,\n    size: tableSize\n  });\n\n  var toolbarArray = typeof toolbarRender === 'function' ? toolbarRender() : [];\n  var showTableTop = headerTitle || toolbarArray && toolbarArray.length || Array.isArray(api);\n\n  var fullScreen = function fullScreen() {\n    var _rootRef$current;\n\n    return Promise.resolve((_rootRef$current = rootRef.current) === null || _rootRef$current === void 0 ? void 0 : _rootRef$current.requestFullscreen());\n  };\n\n  useEffect(function () {\n    if (props.size) {\n      setTable({\n        tableSize: props.size\n      });\n    }\n  }, []);\n  return /*#__PURE__*/React.createElement(ErrorBoundary, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"tr-table-wrapper \".concat(className),\n    style: style,\n    ref: rootRef,\n    id: \"tr-table\"\n  }, debug ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mv2 bg-black-05 pa2 br2\"\n  }, /*#__PURE__*/React.createElement(\"div\", null, 'dataSource:' + JSON.stringify(dataSource))) : null, /*#__PURE__*/React.createElement(\"div\", {\n    className: showTableTop ? 'tr-table-top' : 'tr-table-top-nohead'\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"tr-table-title\"\n  }, /*#__PURE__*/React.createElement(TableTitle, _objectSpread2({\n    title: headerTitle\n  }, props))), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      alignItems: 'flex-start'\n    }\n  }, /*#__PURE__*/React.createElement(_Space, {\n    align: \"center\"\n  }, /*#__PURE__*/React.createElement(_Space, {\n    size: 8,\n    style: {\n      marginRight: 8\n    }\n  }, Array.isArray(toolbarArray) && toolbarArray.map(function (ui, idx) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: idx.toString()\n    }, ui);\n  })), toolbarAction && /*#__PURE__*/React.createElement(ToolBar, {\n    fullScreen: fullScreen\n  })))), /*#__PURE__*/React.createElement(_Table, _objectSpread2({}, tableProps))));\n};\n\nvar TableTitle = function TableTitle(_ref2) {\n  var title = _ref2.title,\n      rest = _objectWithoutProperties(_ref2, _excluded$2);\n\n  var _useTable2 = useTable(),\n      tableState = _useTable2.tableState,\n      setTable = _useTable2.setTable,\n      doSearch = _useTable2.doSearch;\n\n  var tab = tableState.tab,\n      api = tableState.api;\n\n  var _tab = tab || 0;\n\n  var onTabChange = function onTabChange(e) {\n    if (rest.onTabChange && typeof rest.onTabChange === 'function') {\n      return rest.onTabChange(e);\n    }\n\n    var _tab = e.target.value;\n    setTable({\n      tab: _tab\n    });\n    doSearch({\n      tab: _tab\n    });\n  };\n\n  if (typeof api === 'function') return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"tr-single-tab\"\n  }, title);\n\n  if (api && Array.isArray(api)) {\n    if (api.length === 1) return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"tr-single-tab\"\n    }, api[0].name);\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Radio.Group, {\n      onChange: onTabChange,\n      value: _tab\n    }, api.map(function (item, i) {\n      return /*#__PURE__*/React.createElement(_Radio.Button, {\n        key: i.toString(),\n        value: i\n      }, item.name);\n    })), title && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"tr-extra-tab\"\n    }, title));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"tr-single-tab\"\n  }); // 给一个空的占位\n};\n\nexport { Search, ProTable as Table, TableProvider, useTable, withTable };","map":null,"metadata":{},"sourceType":"module"}