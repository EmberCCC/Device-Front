{"ast":null,"code":"import \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/tag/style\";\nimport _Tag from \"antd/lib/tag\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _objectSpread from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\n\nvar _dec,\n    _dec2,\n    _class,\n    _jsxFileName = \"F:\\\\documents\\\\bl-device-manage-test\\\\src\\\\layouts\\\\TableEdit\\\\index.js\";\n\n/*\r\n * @Author: your name\r\n * @Date: 2022-03-22 09:57:59\r\n * @LastEditTime: 2022-04-10 22:50:52\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage\\src\\layouts\\TableEdit\\index.js\r\n */\nimport React, { Component } from 'react';\n// Default SortableJS\nimport Sortable from 'react-sortablejs';\nimport _ from 'lodash';\nimport uniqueId from 'lodash/uniqueId';\nimport update from 'immutability-helper';\nimport { indexToArray, getItem, setInfo, isPath, getCloneItem, itemRemove, itemAdd, changeObj } from '../../utils/loashTools';\nimport { formItemData, GlobalComponent } from './config';\nimport EditableTable from './EditableTable/index';\nimport './index.css';\nimport { NavLink } from 'react-router-dom';\nimport { MenuObj } from 'constants/configs';\nimport { toJS } from 'mobx';\nimport { checkCurrentMenu, isDataExist } from 'utils/dataTools';\nimport * as services from '../../services/home';\nimport { typeName } from 'constants/status_constant';\nimport { inject, observer } from 'mobx-react';\nvar Header = _Layout.Header,\n    Sider = _Layout.Sider,\n    Content = _Layout.Content;\nvar Option = _Select.Option;\nvar sortableOption = {\n  animation: 20,\n  fallbackOnBody: true,\n  swapThreshold: 0.65,\n  group: {\n    name: 'formItem',\n    pull: true,\n    put: true\n  }\n};\nvar EditPage = (_dec = inject('BasicStore'), _dec2 = inject('HomeStore'), _dec(_class = _dec2(_class = observer(_class =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EditPage, _Component);\n\n  function EditPage() {\n    _classCallCheck(this, EditPage);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EditPage).apply(this, arguments));\n  }\n\n  _createClass(EditPage, [{\n    key: \"render\",\n    value: function render() {\n      var itemData = []; // 组件数据\n\n      var isShowModal = false; // 弹框是否显示\n\n      var curItemKey = ''; // 当前选中组件的Key\n\n      var curItemName = ''; // 当前选中组件的Name\n\n      var curItemType = ''; // 当前选中组件的Type\n\n      var isChoose = false; // 组件是否处于选中状态\n\n      var actionId = this.props.selectedKeys[0];\n      var menuObj = toJS(MenuObj.leafMenuModels);\n      var current = checkCurrentMenu({\n        menuObj: menuObj,\n        actionId: actionId\n      });\n      var firstFormId = current.currentMenu[0].id;\n      var secondFormId = this.props.secondFormId;\n\n      var handleSubmit = function handleSubmit() {};\n\n      var handlePreview = function handlePreview() {\n        console.log('itemData:' + JSON.stringify(itemData));\n        setIsChoose(false);\n        setIsShowModal(true);\n      };\n\n      var handleLabelChange = function handleLabelChange(e) {\n        var val = e.target.value;\n        setCurItemName(val);\n        itemData[curItemKey].label = val;\n        setItemData.apply(void 0, [itemData]);\n      };\n\n      var handleDel = function handleDel() {\n        var newTreeData = itemRemove(curItemKey, itemData);\n        setCurItemKey('');\n        setCurItemName('');\n        setCurItemType('');\n        setItemData(_toConsumableArray(newTreeData));\n      };\n\n      var sortableChoose = function sortableChoose(e) {\n        console.log(e);\n        setIsChoose(true);\n        var curKey = e.item.getAttribute('data-id');\n        var curName = e.item.firstChild.innerText;\n        var curType = e.item.getAttribute('type');\n        setCurItemKey(curKey);\n        setCurItemName(curName);\n        setCurItemType(curType);\n      }; // 拖拽的添加方法\n\n\n      var sortableAdd = function sortableAdd(e) {\n        // 组件名或路径\n        var nameOrIndex = e.clone.getAttribute('data-id'); // 父节点路径\n\n        var parentPath = e.path[1].getAttribute('data-id'); // 拖拽元素的目标路径\n\n        var newIndex = e.newIndex; // 新路径 为根节点时直接使用index\n\n        var newPath = parentPath ? \"\".concat(parentPath, \"-\").concat(newIndex) : newIndex;\n        console.log('nameOrIndex:' + nameOrIndex, 'parentPath:' + parentPath, 'newIndex:' + newIndex, 'newPath:' + newPath); // 判断是否为路径 路径执行移动，非路径为新增\n\n        if (isPath(nameOrIndex)) {\n          // 旧的路径index\n          var oldIndex = nameOrIndex; // 克隆要移动的元素\n\n          var dragItem = getCloneItem(oldIndex, itemData); // 比较路径的上下位置 先执行靠下的数据 再执行靠上数据\n\n          if (indexToArray(oldIndex) > indexToArray(newPath)) {\n            // 删除元素 获得新数据\n            var newTreeData = itemRemove(oldIndex, itemData); // 添加拖拽元素\n\n            newTreeData = itemAdd(newPath, newTreeData, dragItem); // 更新视图\n\n            setItemData(_toConsumableArray(newTreeData));\n            return;\n          } // 添加拖拽元素\n\n\n          var newData = itemAdd(newPath, itemData, dragItem); // 删除元素 获得新数据\n\n          newData = itemRemove(oldIndex, newData);\n          setItemData(_toConsumableArray(newData));\n          return;\n        } // 新增流程 创建元素 => 插入元素 => 更新视图\n\n\n        var id = nameOrIndex;\n\n        var newItem = _.cloneDeep(formItemData.find(function (item) {\n          return item.name === id;\n        })); // 为容器或者弹框时增加子元素\n\n\n        if (newItem.name === 'Containers') {\n          var ComponentsInfo = _.cloneDeep(GlobalComponent[newItem.name]); // 判断是否包含默认数据\n\n\n          newItem.children = [ComponentsInfo];\n        }\n\n        var Data = itemAdd(newPath, itemData, newItem);\n        setItemData(_toConsumableArray(Data));\n      }; // 拖拽的排序方法\n\n\n      var sortableUpdate = function sortableUpdate(e) {\n        // 交换数组\n        var newIndex = e.newIndex,\n            oldIndex = e.oldIndex; // 父节点路径\n\n        var parentPath = e.path[1].getAttribute('data-id'); // 父元素 根节点时直接调用data\n\n        var parent = parentPath ? getItem(parentPath, itemData) : itemData; // 当前拖拽元素\n\n        var dragItem = parent[oldIndex]; // 更新后的父节点\n\n        parent = update(parent, {\n          $splice: [[oldIndex, 1], [newIndex, 0, dragItem]]\n        }); // 最新的数据 根节点时直接调用data\n\n        var Data = parentPath ? setInfo(parentPath, itemData, parent) : parent; // 调用父组件更新方法\n\n        setItemData(_toConsumableArray(Data));\n      }; //转换为所需对象\n\n\n      var changeField = function changeField() {\n        var obj = itemData;\n\n        if (itemData.length != 0) {\n          var itemData1 = itemData.filter(function (txt) {\n            return txt.secondFormId == secondFormId;\n          });\n\n          if (itemData1.length == 0) {\n            return obj;\n          }\n\n          var properties = {};\n          properties = toJS(itemData1[0].properties);\n          properties.forEach(function (element) {\n            if (element.propertyId != undefined) {\n              var ele = {};\n              ele.label = element.name;\n              ele.attr = element.others;\n              ele.propertyId = element.propertyId;\n              ele.name = typeName[element.typeId];\n              obj.push(ele);\n            }\n\n            obj.push(element);\n          });\n        }\n\n        return obj;\n      }; // 递归函数\n\n\n      var loop = function loop(arr, index) {\n        arr = changeField();\n        return arr.map(function (item, i) {\n          var indexs = index === '' ? String(i) : \"\".concat(index, \"-\").concat(i);\n\n          if (item) {\n            if (item.children) {\n              return React.createElement(\"div\", Object.assign({}, item.attr, {\n                \"data-id\": indexs,\n                key: indexs,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 199\n                },\n                __self: this\n              }), React.createElement(Sortable, {\n                key: uniqueId(),\n                style: {\n                  minHeight: 100,\n                  margin: 10\n                },\n                ref: function ref(c) {\n                  return c && c.sortable;\n                },\n                options: _objectSpread({}, sortableOption, {\n                  onUpdate: function onUpdate(e) {\n                    return sortableUpdate(e);\n                  },\n                  onAdd: function onAdd(e) {\n                    return sortableAdd(e);\n                  },\n                  onChoose: function onChoose(e) {\n                    return sortableChoose(e);\n                  },\n                  onSort: function onSort(e) {\n                    return setIsChoose(false);\n                  }\n                }),\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 200\n                },\n                __self: this\n              }, loop(item.children, indexs)));\n            }\n\n            var ComponentInfo = GlobalComponent[item.name];\n            return React.createElement(\"div\", {\n              \"data-id\": indexs,\n              key: indexs,\n              type: item.name,\n              className: \"formItemStyle\",\n              style: isChoose && indexs === curItemKey ? {\n                border: '1px solid #FF3333'\n              } : {},\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 219\n              },\n              __self: this\n            }, item.name !== 'Divider' && React.createElement(\"div\", {\n              className: \"formItemLabel\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 228\n              },\n              __self: this\n            }, isChoose ? indexs === curItemKey ? curItemName : item.label : item.label), renderDiffComponents(item, indexs, ComponentInfo));\n          } else {\n            return null;\n          }\n        });\n      };\n\n      var renderDiffComponents = function renderDiffComponents(item, indexs, ComponentInfo) {\n        switch (item.name) {\n          case 'Divider':\n            return React.createElement(ComponentInfo, Object.assign({\n              key: indexs\n            }, item.attr, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 245\n              },\n              __self: this\n            }));\n\n          case 'Select':\n            return React.createElement(ComponentInfo, {\n              key: indexs,\n              defaultValue: item.attr.value,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 248\n              },\n              __self: this\n            }, item.attr.options.map(function (subItem) {\n              return React.createElement(Option, {\n                key: subItem.key,\n                value: subItem.value + '',\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 250\n                },\n                __self: this\n              }, subItem.label);\n            }));\n\n          default:\n            return React.createElement(ComponentInfo, Object.assign({\n              key: indexs\n            }, item.attr, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 255\n              },\n              __self: this\n            }));\n        }\n      };\n\n      var getDataSource = function getDataSource(options) {\n        itemData[curItemKey].attr.options = _toConsumableArray(options);\n        setItemData([].concat(itemData));\n      };\n\n      var save = function save(params) {\n        _Modal.confirm({\n          title: '提示',\n          content: '是否修改该表单',\n          okText: '确认',\n          cancelText: '取消',\n          onOk: function onOk() {\n            try {\n              var res = services.putRequest(services.requestList.updataField, params);\n\n              _message.success('修改成功');\n            } catch (error) {\n              console.log(error);\n            }\n          },\n          onCancel: function onCancel() {\n            console.log('Cancel');\n          }\n        });\n      };\n\n      var saveForm = function saveForm() {\n        var text = [];\n        itemData.map(function (element, index) {\n          text.push(changeObj(firstFormId, 0, element, index));\n        });\n        console.log(text);\n        save(text);\n      };\n\n      return React.createElement(_Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296\n        },\n        __self: this\n      }, React.createElement(Header, {\n        className: \"header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297\n        },\n        __self: this\n      }, React.createElement(NavLink, {\n        to: \"/basic\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, React.createElement(_Button, {\n        type: \"dashed\",\n        class: \"backButton\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, \"Back\")), React.createElement(_Menu, {\n        theme: \"light\",\n        mode: \"horizontal\",\n        defaultSelectedKeys: ['2'],\n        justify: \"center\",\n        class: \"headerMenu\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299\n        },\n        __self: this\n      }, React.createElement(_Menu.Item, {\n        key: \"1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }, \"nav 1\"), React.createElement(_Menu.Item, {\n        key: \"2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 301\n        },\n        __self: this\n      }, \"nav 2\"), React.createElement(_Menu.Item, {\n        key: \"3\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302\n        },\n        __self: this\n      }, \"nav 3\")), React.createElement(_Button, {\n        onClick: saveForm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304\n        },\n        __self: this\n      }, \"\\u4FDD\\u5B58\")), React.createElement(_Layout, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }, React.createElement(Sider, {\n        width: '15%',\n        style: {\n          height: '100%',\n          borderLeft: 10,\n          minHeight: 840,\n          marginTop: 20,\n          textAlign: 'center'\n        },\n        theme: \"light\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        className: \"textHead\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308\n        },\n        __self: this\n      }, \"\\u7EC4\\u4EF6\\u5217\\u8868\"), React.createElement(Sortable, {\n        options: {\n          group: {\n            name: 'formItem',\n            pull: 'clone',\n            put: false\n          },\n          sort: false\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309\n        },\n        __self: this\n      }, formItemData.map(function (item) {\n        return React.createElement(\"div\", {\n          \"data-id\": item.name,\n          key: item.name,\n          style: {\n            marginTop: 10\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 321\n          },\n          __self: this\n        }, React.createElement(_Tag, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 326\n          },\n          __self: this\n        }, item.label + '-' + item.name));\n      }))), React.createElement(_Layout, {\n        style: {\n          padding: '0 24px 24px',\n          marginTop: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332\n        },\n        __self: this\n      }, React.createElement(Content, {\n        className: \"site-layout-background\",\n        style: {\n          padding: 24,\n          margin: 0,\n          minHeight: 300\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333\n        },\n        __self: this\n      }, React.createElement(Sortable, {\n        className: \"formContent\",\n        ref: function ref(c) {\n          return c && c.sortable;\n        },\n        options: _objectSpread({}, sortableOption, {\n          onUpdate: function onUpdate(e) {\n            return sortableUpdate(e);\n          },\n          onAdd: function onAdd(e) {\n            return sortableAdd(e);\n          },\n          onChoose: function onChoose(e) {\n            return sortableChoose(e);\n          },\n          onSort: function onSort(e) {\n            return setIsChoose(false);\n          }\n        }),\n        key: uniqueId(),\n        style: {\n          minHeight: '100%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341\n        },\n        __self: this\n      }, loop(itemData, ''))), React.createElement(Sider, {\n        theme: \"light\",\n        width: '20%',\n        style: {\n          textAlign: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 357\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        className: \"textHead\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358\n        },\n        __self: this\n      }, \"\\u5B57\\u6BB5\\u8BBE\\u7F6E\"), React.createElement(_Form, {\n        className: \"itemForm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 359\n        },\n        __self: this\n      }, React.createElement(_Form.Item, {\n        label: \"\\u7EC4\\u4EF6Key\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 360\n        },\n        __self: this\n      }, React.createElement(_Input, {\n        value: curItemKey,\n        disabled: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 361\n        },\n        __self: this\n      })), React.createElement(_Form.Item, {\n        label: \"\\u6807\\u7B7E\\u540D\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363\n        },\n        __self: this\n      }, React.createElement(_Input, {\n        value: curItemName,\n        disabled: !isChoose,\n        onChange: handleLabelChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 364\n        },\n        __self: this\n      })), ['CheckboxGroup', 'RadioGroup', 'Select'].includes(curItemType) && React.createElement(EditableTable, {\n        getDataSource: getDataSource,\n        curItemKey: curItemKey,\n        options: itemData[curItemKey].attr.options,\n        disabled: !isChoose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 368\n        },\n        __self: this\n      })), React.createElement(_Button, {\n        className: \"delBtn\",\n        onClick: handleDel,\n        disabled: !isChoose,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 376\n        },\n        __self: this\n      }, \"\\u5220\\u9664\")))));\n    }\n  }]);\n\n  return EditPage;\n}(Component)) || _class) || _class) || _class);\nexport default EditPage;","map":{"version":3,"sources":["F:\\documents\\bl-device-manage-test\\src\\layouts\\TableEdit\\index.js"],"names":["React","Component","Sortable","_","uniqueId","update","indexToArray","getItem","setInfo","isPath","getCloneItem","itemRemove","itemAdd","changeObj","formItemData","GlobalComponent","EditableTable","NavLink","MenuObj","toJS","checkCurrentMenu","isDataExist","services","typeName","inject","observer","Header","Sider","Content","Option","sortableOption","animation","fallbackOnBody","swapThreshold","group","name","pull","put","EditPage","itemData","isShowModal","curItemKey","curItemName","curItemType","isChoose","actionId","props","selectedKeys","menuObj","leafMenuModels","current","firstFormId","currentMenu","id","secondFormId","handleSubmit","handlePreview","console","log","JSON","stringify","setIsChoose","setIsShowModal","handleLabelChange","e","val","target","value","setCurItemName","label","setItemData","handleDel","newTreeData","setCurItemKey","setCurItemType","sortableChoose","curKey","item","getAttribute","curName","firstChild","innerText","curType","sortableAdd","nameOrIndex","clone","parentPath","path","newIndex","newPath","oldIndex","dragItem","newData","newItem","cloneDeep","find","ComponentsInfo","children","Data","sortableUpdate","parent","$splice","changeField","obj","length","itemData1","filter","txt","properties","forEach","element","propertyId","undefined","ele","attr","others","typeId","push","loop","arr","index","map","i","indexs","String","minHeight","margin","c","sortable","onUpdate","onAdd","onChoose","onSort","ComponentInfo","border","renderDiffComponents","options","subItem","key","getDataSource","save","params","confirm","title","content","okText","cancelText","onOk","res","putRequest","requestList","updataField","success","error","onCancel","saveForm","text","height","borderLeft","marginTop","textAlign","sort","padding","includes"],"mappings":"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","sourcesContent":["/*\r\n * @Author: your name\r\n * @Date: 2022-03-22 09:57:59\r\n * @LastEditTime: 2022-04-10 22:50:52\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage\\src\\layouts\\TableEdit\\index.js\r\n */\r\n\r\nimport React, { Component } from 'react';\r\nimport { Tag, Layout, Button, Modal, message, Form, Input, Select, Menu } from 'antd';\r\n// Default SortableJS\r\nimport Sortable from 'react-sortablejs';\r\nimport _ from 'lodash';\r\nimport uniqueId from 'lodash/uniqueId';\r\nimport update from 'immutability-helper';\r\nimport { indexToArray, getItem, setInfo, isPath, getCloneItem, itemRemove, itemAdd, changeObj } from '../../utils/loashTools';\r\nimport { formItemData, GlobalComponent } from './config';\r\nimport EditableTable from './EditableTable/index';\r\nimport './index.css'\r\nimport { NavLink } from 'react-router-dom';\r\nimport { MenuObj } from 'constants/configs';\r\nimport { toJS } from 'mobx';\r\nimport { checkCurrentMenu, isDataExist } from 'utils/dataTools';\r\nimport * as services from '../../services/home';\r\nimport { typeName } from 'constants/status_constant';\r\nimport { inject, observer } from 'mobx-react';\r\n\r\n\r\nconst { Header, Sider, Content } = Layout;\r\nconst { Option } = Select;\r\nconst sortableOption = {\r\n  animation: 20,\r\n  fallbackOnBody: true,\r\n  swapThreshold: 0.65,\r\n  group: {\r\n    name: 'formItem',\r\n    pull: true,\r\n    put: true,\r\n  },\r\n};\r\n\r\n\r\n@inject('BasicStore')\r\n@inject('HomeStore')\r\n@observer\r\nclass EditPage extends Component{\r\n  render(){\r\n    const itemData = [];                  // 组件数据\r\n    const isShowModal = false;            // 弹框是否显示\r\n    const curItemKey = '';             // 当前选中组件的Key\r\n    const curItemName = '';           // 当前选中组件的Name\r\n    const curItemType = '';           // 当前选中组件的Type\r\n    const isChoose = false;                  // 组件是否处于选中状态\r\n  \r\n    let actionId = this.props.selectedKeys[0];\r\n    let menuObj = toJS(MenuObj.leafMenuModels);\r\n    let current = checkCurrentMenu({ menuObj, actionId });\r\n    let firstFormId = current.currentMenu[0].id;\r\n    let secondFormId = this.props.secondFormId;\r\n    const handleSubmit = () => {\r\n\r\n    };\r\n  \r\n    const handlePreview = () => {\r\n      console.log('itemData:' + JSON.stringify(itemData))\r\n      setIsChoose(false)\r\n      setIsShowModal(true)\r\n    };\r\n  \r\n    const handleLabelChange = (e) => {\r\n      const val = e.target.value;\r\n      setCurItemName(val);\r\n      itemData[curItemKey].label = val;\r\n      setItemData(...[itemData]);\r\n    }\r\n  \r\n    const handleDel = () => {\r\n      let newTreeData = itemRemove(curItemKey, itemData);\r\n      setCurItemKey('');\r\n      setCurItemName('');\r\n      setCurItemType('');\r\n      setItemData([...newTreeData])\r\n    }\r\n  \r\n    const sortableChoose = (e) => {\r\n      console.log(e)\r\n      setIsChoose(true);\r\n      const curKey = e.item.getAttribute('data-id');\r\n      const curName = e.item.firstChild.innerText;\r\n      const curType = e.item.getAttribute('type');\r\n      setCurItemKey(curKey);\r\n      setCurItemName(curName);\r\n      setCurItemType(curType)\r\n    };\r\n  \r\n    // 拖拽的添加方法\r\n    const sortableAdd = e => {\r\n      // 组件名或路径\r\n      const nameOrIndex = e.clone.getAttribute('data-id');\r\n      // 父节点路径\r\n      const parentPath = e.path[1].getAttribute('data-id');\r\n      // 拖拽元素的目标路径\r\n      const { newIndex } = e;\r\n      // 新路径 为根节点时直接使用index\r\n      const newPath = parentPath ? `${parentPath}-${newIndex}` : newIndex;\r\n      console.log('nameOrIndex:' + nameOrIndex, 'parentPath:' + parentPath, 'newIndex:' + newIndex, 'newPath:' + newPath)\r\n      // 判断是否为路径 路径执行移动，非路径为新增\r\n      if (isPath(nameOrIndex)) {\r\n        // 旧的路径index\r\n        const oldIndex = nameOrIndex;\r\n        // 克隆要移动的元素\r\n        const dragItem = getCloneItem(oldIndex, itemData)\r\n        // 比较路径的上下位置 先执行靠下的数据 再执行靠上数据\r\n        if (indexToArray(oldIndex) > indexToArray(newPath)) {\r\n          // 删除元素 获得新数据\r\n          let newTreeData = itemRemove(oldIndex, itemData);\r\n          // 添加拖拽元素\r\n          newTreeData = itemAdd(newPath, newTreeData, dragItem)\r\n          // 更新视图\r\n          setItemData([...newTreeData])\r\n          return\r\n        }\r\n        // 添加拖拽元素\r\n        let newData = itemAdd(newPath, itemData, dragItem)\r\n        // 删除元素 获得新数据\r\n        newData = itemRemove(oldIndex, newData);\r\n        setItemData([...newData])\r\n        return\r\n      }\r\n  \r\n      // 新增流程 创建元素 => 插入元素 => 更新视图\r\n      const id = nameOrIndex\r\n      const newItem = _.cloneDeep(formItemData.find(item => (item.name === id)))\r\n      // 为容器或者弹框时增加子元素\r\n      if (newItem.name === 'Containers') {\r\n        const ComponentsInfo = _.cloneDeep(GlobalComponent[newItem.name])\r\n        // 判断是否包含默认数据\r\n        newItem.children = [ComponentsInfo]\r\n      }\r\n      let Data = itemAdd(newPath, itemData, newItem)\r\n      setItemData([...Data])\r\n    };\r\n  \r\n    // 拖拽的排序方法\r\n    const sortableUpdate = e => {\r\n      // 交换数组\r\n      const { newIndex, oldIndex } = e;\r\n      // 父节点路径\r\n      const parentPath = e.path[1].getAttribute('data-id');\r\n      // 父元素 根节点时直接调用data\r\n      let parent = parentPath ? getItem(parentPath, itemData) : itemData;\r\n      // 当前拖拽元素\r\n      const dragItem = parent[oldIndex];\r\n      // 更新后的父节点\r\n      parent = update(parent, {\r\n        $splice: [[oldIndex, 1], [newIndex, 0, dragItem]],\r\n      });\r\n      // 最新的数据 根节点时直接调用data\r\n      const Data = parentPath ? setInfo(parentPath, itemData, parent) : parent\r\n      // 调用父组件更新方法\r\n      setItemData([...Data])\r\n    };\r\n    //转换为所需对象\r\n    const changeField = () => {\r\n      let obj = itemData\r\n      if (itemData.length != 0) {\r\n        let itemData1 = itemData.filter(function (txt) {\r\n          return txt.secondFormId == secondFormId\r\n        })\r\n        if (itemData1.length == 0) {\r\n          return obj;\r\n        }\r\n        let properties = {}\r\n        properties = toJS(itemData1[0].properties)\r\n        properties.forEach(element => {\r\n          if (element.propertyId != undefined) {\r\n            let ele = {}\r\n            ele.label = element.name\r\n            ele.attr = element.others\r\n            ele.propertyId = element.propertyId\r\n            ele.name = typeName[element.typeId]\r\n            obj.push(ele)\r\n          }\r\n          obj.push(element)\r\n        });\r\n      }\r\n      return obj\r\n    }\r\n    // 递归函数\r\n    const loop = (arr, index) => {\r\n      arr = changeField()\r\n      return (\r\n        arr.map((item, i) => {\r\n          const indexs = index === '' ? String(i) : `${index}-${i}`;\r\n          if (item) {\r\n            if (item.children) {\r\n              return (\r\n                <div {...item.attr} data-id={indexs} key={indexs}>\r\n                  <Sortable\r\n                    key={uniqueId()}\r\n                    style={{ minHeight: 100, margin: 10 }}\r\n                    ref={c => c && c.sortable}\r\n                    options={{\r\n                      ...sortableOption,\r\n                      onUpdate: e => sortableUpdate(e),\r\n                      onAdd: e => sortableAdd(e),\r\n                      onChoose: e => sortableChoose(e),\r\n                      onSort: e => setIsChoose(false),\r\n                    }}\r\n                  >\r\n                    {loop(item.children, indexs)}\r\n                  </Sortable>\r\n                </div>\r\n              )\r\n            }\r\n            const ComponentInfo = GlobalComponent[item.name]\r\n            return (\r\n              <div\r\n                data-id={indexs}\r\n                key={indexs}\r\n                type={item.name}\r\n                className='formItemStyle'\r\n                style={(isChoose && indexs === curItemKey) ? { border: '1px solid #FF3333' } : {}}\r\n              >\r\n                {\r\n                  item.name !== 'Divider' &&\r\n                  <div className='formItemLabel'>{isChoose ? (indexs === curItemKey ? curItemName : item.label) : item.label}</div>\r\n                }\r\n                {\r\n                  renderDiffComponents(item, indexs, ComponentInfo)\r\n                }\r\n              </div>\r\n            )\r\n          } else {\r\n            return null\r\n          }\r\n        })\r\n      )\r\n    };\r\n  \r\n    const renderDiffComponents = (item, indexs, ComponentInfo) => {\r\n      switch (item.name) {\r\n        case 'Divider':\r\n          return <ComponentInfo key={indexs} {...item.attr}></ComponentInfo>\r\n        case 'Select':\r\n          return (\r\n            <ComponentInfo key={indexs} defaultValue={item.attr.value}>\r\n              {\r\n                item.attr.options.map(subItem => <Option key={subItem.key} value={subItem.value + ''}>{subItem.label}</Option>)\r\n              }\r\n            </ComponentInfo>\r\n          )\r\n        default:\r\n          return <ComponentInfo key={indexs} {...item.attr} />\r\n      }\r\n    }\r\n  \r\n    const getDataSource = (options) => {\r\n      itemData[curItemKey].attr.options = [...options];\r\n      setItemData([...itemData])\r\n    }\r\n  \r\n    const save = (params) => {\r\n      Modal.confirm({\r\n        title: '提示',\r\n        content: '是否修改该表单',\r\n        okText: '确认',\r\n        cancelText: '取消',\r\n        onOk() {\r\n          try {\r\n            let res = services.putRequest(services.requestList.updataField, params);\r\n            message.success('修改成功')\r\n          } catch (error) {\r\n            console.log(error);\r\n          }\r\n  \r\n        },\r\n        onCancel() {\r\n          console.log('Cancel');\r\n        },\r\n      });\r\n  \r\n    }\r\n  \r\n    const saveForm = () => {\r\n      let text = []\r\n      itemData.map((element, index) => {\r\n        text.push(changeObj(firstFormId, 0, element, index))\r\n      });\r\n      console.log(text);\r\n      save(text)\r\n  \r\n    }\r\n    return (\r\n      <Layout>\r\n        <Header className=\"header\">\r\n          <NavLink to='/basic'><Button type='dashed' class='backButton'>Back</Button></NavLink>\r\n          <Menu theme=\"light\" mode=\"horizontal\" defaultSelectedKeys={['2']} justify='center' class='headerMenu'>\r\n            <Menu.Item key=\"1\">nav 1</Menu.Item>\r\n            <Menu.Item key=\"2\">nav 2</Menu.Item>\r\n            <Menu.Item key=\"3\">nav 3</Menu.Item>\r\n          </Menu>\r\n          <Button onClick={saveForm}>保存</Button>\r\n        </Header>\r\n        <Layout>\r\n          <Sider width={'15%'} style={{ height: '100%', borderLeft: 10, minHeight: 840, marginTop: 20, textAlign: 'center' }} theme='light'>\r\n            <h3 className='textHead'>组件列表</h3>\r\n            <Sortable\r\n              options={{\r\n                group: {\r\n                  name: 'formItem',\r\n                  pull: 'clone',\r\n                  put: false,\r\n                },\r\n                sort: false,\r\n              }}\r\n            >\r\n              {\r\n                formItemData.map(item => (\r\n                  <div\r\n                    data-id={item.name}\r\n                    key={item.name}\r\n                    style={{ marginTop: 10 }}\r\n                  >\r\n                    <Tag>{item.label + '-' + item.name}</Tag>\r\n                  </div>\r\n                ))\r\n              }\r\n            </Sortable>\r\n          </Sider>\r\n          <Layout style={{ padding: '0 24px 24px', marginTop: 20 }}>\r\n            <Content\r\n              className=\"site-layout-background\"\r\n              style={{\r\n                padding: 24,\r\n                margin: 0,\r\n                minHeight: 300,\r\n              }}\r\n            >\r\n              <Sortable\r\n                className='formContent'\r\n                ref={c => c && c.sortable}\r\n                options={{\r\n                  ...sortableOption,\r\n                  onUpdate: e => sortableUpdate(e),\r\n                  onAdd: e => sortableAdd(e),\r\n                  onChoose: e => sortableChoose(e),\r\n                  onSort: e => setIsChoose(false),\r\n                }}\r\n                key={uniqueId()}\r\n                style={{ minHeight: '100%' }}\r\n              >\r\n                {loop(itemData, '')}\r\n              </Sortable>\r\n            </Content>\r\n            <Sider theme='light' width={'20%'} style={{ textAlign: 'center' }}>\r\n              <h3 className='textHead'>字段设置</h3>\r\n              <Form className='itemForm'>\r\n                <Form.Item label=\"组件Key\">\r\n                  <Input value={curItemKey} disabled />\r\n                </Form.Item>\r\n                <Form.Item label=\"标签名\">\r\n                  <Input value={curItemName} disabled={!isChoose} onChange={handleLabelChange} />\r\n                </Form.Item>\r\n                {\r\n                  ['CheckboxGroup', 'RadioGroup', 'Select'].includes(curItemType) &&\r\n                  <EditableTable\r\n                    getDataSource={getDataSource}\r\n                    curItemKey={curItemKey}\r\n                    options={itemData[curItemKey].attr.options}\r\n                    disabled={!isChoose}\r\n                  />\r\n                }\r\n              </Form>\r\n              <Button className='delBtn' onClick={handleDel} disabled={!isChoose}>删除</Button>\r\n            </Sider>\r\n          </Layout>\r\n        </Layout>\r\n      </Layout>\r\n    );\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nexport default EditPage;"]},"metadata":{},"sourceType":"module"}