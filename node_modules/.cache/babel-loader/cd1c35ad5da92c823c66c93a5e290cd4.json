{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _objectSpread from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/input-number/style\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport _objectWithoutProperties from \"F:\\\\documents\\\\bl-device-manage-test\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"F:\\\\documents\\\\bl-device-manage-test\\\\src\\\\components\\\\GlobalTabel\\\\index.js\";\n\n/*\r\n * @Author: your name\r\n * @Date: 2022-04-07 11:58:39\r\n * @LastEditTime: 2022-04-22 18:26:14\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage-test\\src\\components\\GlobalTabel\\index.js\r\n */\nimport React, { useState } from 'react';\nimport { toJS } from 'mobx';\nimport { GlobalComponent } from 'layouts/TableEdit/config';\n\nvar EditableCell = function EditableCell(_ref) {\n  var editing = _ref.editing,\n      dataIndex = _ref.dataIndex,\n      title = _ref.title,\n      inputType = _ref.inputType,\n      record = _ref.record,\n      index = _ref.index,\n      children = _ref.children,\n      restProps = _objectWithoutProperties(_ref, [\"editing\", \"dataIndex\", \"title\", \"inputType\", \"record\", \"index\", \"children\"]);\n\n  var inputNode = inputType === 'number' ? React.createElement(_InputNumber, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  }) : React.createElement(_Input, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  });\n  console.log(toJS(record));\n  return React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27\n    },\n    __self: this\n  }, editing ? React.createElement(_Form.Item, {\n    name: dataIndex,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29\n    },\n    __self: this\n  }, inputNode) : children);\n};\n\nvar Option = _Select.Option;\n\nvar renderDiffComponents = function renderDiffComponents(item, indexs, ComponentInfo) {\n  switch (item.name) {\n    case 'Divider':\n      return React.createElement(ComponentInfo, Object.assign({\n        key: indexs\n      }, item.attr, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 45\n        },\n        __self: this\n      }));\n\n    case 'Select':\n      return React.createElement(ComponentInfo, {\n        key: indexs,\n        defaultValue: item.attr.value,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }, item.attr.options.map(function (subItem) {\n        return React.createElement(Option, {\n          key: subItem.key,\n          value: subItem.value + '',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 50\n          },\n          __self: this\n        }, subItem.label);\n      }));\n\n    default:\n      return React.createElement(ComponentInfo, Object.assign({\n        key: indexs\n      }, item.attr, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55\n        },\n        __self: this\n      }));\n  }\n};\n\nvar GlobalTabel = function GlobalTabel(props) {\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var data = props.dataSource;\n  var firstFormId = props.firstFormId;\n  var secondFormId = props.secondFormId;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      editingKey = _useState2[0],\n      setEditingKey = _useState2[1];\n\n  var del = props.del;\n  var getData = props.getData;\n  var updataData = props.updataData;\n  var isLoading = props.loading;\n  var page = {\n    pageIndex: 1,\n    pageSize: 2\n  };\n\n  var isEditing = function isEditing(record) {\n    return record.key === editingKey;\n  };\n\n  var edit = function edit(record) {\n    setEditingKey(record.key);\n  };\n\n  var cancel = function cancel(e) {\n    page.pageIndex = e.current;\n    setEditingKey('');\n  };\n\n  var save =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(key) {\n      var row, newData, index, _item, item, params;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return form.validateFields();\n\n            case 3:\n              row = _context.sent;\n              newData = _toConsumableArray(data);\n              index = newData.findIndex(function (item) {\n                return key === item.key;\n              });\n\n              if (index > -1) {\n                _item = newData[index];\n                newData.splice(index, 1, _objectSpread({}, _item, row));\n              } else {\n                newData.push(row);\n              }\n\n              item = newData[index];\n              params = {};\n              params.firstFormId = firstFormId;\n              params.secondFormId = secondFormId;\n              params.dataId = item.id.toString();\n\n              _Modal.confirm({\n                title: '提示',\n                content: '是否确认修改该条数据',\n                okText: '确认',\n                cancelText: '取消',\n                onOk: function onOk() {\n                  var newObj = {};\n                  Object.keys(item).map(function (obj) {\n                    if (obj.startsWith('tenement')) {\n                      newObj[obj] = item[obj];\n                    }\n                  });\n                  params.updataData = newObj;\n                  updataData(params);\n                  setEditingKey('');\n\n                  _message.success('修改成功');\n                },\n                onCancel: function onCancel() {\n                  console.log('Cancel');\n                }\n              });\n\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](0);\n              console.log('Validate Failed:', _context.t0);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 15]]);\n    }));\n\n    return function save(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var deleteRecord = function deleteRecord(txt) {\n    var params = {};\n    params.firstFormId = firstFormId;\n    params.secondFormId = secondFormId;\n    params.dataId = txt.id.toString();\n\n    _Modal.confirm({\n      title: '提示',\n      content: '是否确认删除该条数据',\n      okText: '确认',\n      cancelText: '取消',\n      onOk: function onOk() {\n        del(params);\n        getData(page);\n        props.countObj(firstFormId);\n        setEditingKey('');\n\n        _message.success('删除成功');\n      },\n      onCancel: function onCancel() {\n        console.log('Cancel');\n      }\n    });\n  };\n\n  var columns = props.columns;\n  var obj = columns;\n  var text = obj.pop();\n\n  if (text != undefined && !('align' in text)) {\n    obj.push(text);\n  }\n\n  obj.push({\n    align: 'right',\n    width: '20%',\n    title: '操作',\n    dataIndex: '操作',\n    render: function render(_, record) {\n      var editable = isEditing(record);\n      return editable ? React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        onClick: function onClick() {\n          return save(record.key);\n        },\n        style: {\n          marginRight: 8\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, \"Save\"), React.createElement(_Popconfirm, {\n        title: \"Sure to cancel?\",\n        onConfirm: cancel,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, \"Cancel\")), React.createElement(_Divider, {\n        type: \"vertical\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }), React.createElement(\"a\", {\n        onClick: function onClick() {\n          return deleteRecord(record);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, \"Delete\")) : React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(\"a\", {\n        disabled: editingKey !== '',\n        onClick: function onClick() {\n          return edit(record);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, \"Edit\"));\n    }\n  });\n\n  for (var index = 0; index < columns.length - 4; index++) {\n    var element = columns[index];\n    element.editable = true;\n  }\n\n  var mergedColumns = columns.map(function (col) {\n    if (!col.editable) {\n      return col;\n    }\n\n    console.log(col);\n    return _objectSpread({}, col, {\n      onCell: function onCell(record) {\n        return {\n          record: record,\n          inputType: col.type,\n          dataIndex: col.dataIndex,\n          title: col.title,\n          editing: isEditing(record)\n        };\n      }\n    });\n  });\n  return React.createElement(_Form, {\n    form: form,\n    component: false,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, React.createElement(_Table, {\n    components: {\n      body: {\n        cell: EditableCell\n      }\n    },\n    bordered: true,\n    dataSource: data,\n    columns: mergedColumns,\n    rowClassName: \"editable-row\",\n    pagination: props.PageInfo,\n    onChange: cancel,\n    loading: isLoading,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }));\n};\n\nexport default GlobalTabel;","map":{"version":3,"sources":["F:\\documents\\bl-device-manage-test\\src\\components\\GlobalTabel\\index.js"],"names":["React","useState","toJS","GlobalComponent","EditableCell","editing","dataIndex","title","inputType","record","index","children","restProps","inputNode","console","log","Option","renderDiffComponents","item","indexs","ComponentInfo","name","attr","value","options","map","subItem","key","label","GlobalTabel","props","useForm","form","data","dataSource","firstFormId","secondFormId","editingKey","setEditingKey","del","getData","updataData","isLoading","loading","page","pageIndex","pageSize","isEditing","edit","cancel","e","current","save","validateFields","row","newData","findIndex","splice","push","params","dataId","id","toString","confirm","content","okText","cancelText","onOk","newObj","Object","keys","obj","startsWith","success","onCancel","deleteRecord","txt","countObj","columns","text","pop","undefined","align","width","render","_","editable","marginRight","length","element","mergedColumns","col","onCell","type","body","cell","PageInfo"],"mappings":"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","sourcesContent":["/*\r\n * @Author: your name\r\n * @Date: 2022-04-07 11:58:39\r\n * @LastEditTime: 2022-04-22 18:26:14\r\n * @LastEditors: Please set LastEditors\r\n * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n * @FilePath: \\bl-device-manage-test\\src\\components\\GlobalTabel\\index.js\r\n */\r\nimport React, { useState } from 'react';\r\nimport { Table, Input, InputNumber, Popconfirm, Form, Select, Modal, message, Divider } from 'antd';\r\nimport { toJS } from 'mobx';\r\nimport { GlobalComponent } from 'layouts/TableEdit/config';\r\n\r\nconst EditableCell = ({\r\n  editing,\r\n  dataIndex,\r\n  title,\r\n  inputType,\r\n  record,\r\n  index,\r\n  children,\r\n  ...restProps\r\n}) => {\r\n  const inputNode = inputType === 'number' ? <InputNumber /> : <Input />;\r\n  console.log(toJS(record));\r\n  return (\r\n    <td>\r\n      {editing ? (\r\n        <Form.Item\r\n          name={dataIndex}\r\n        >\r\n          {inputNode}\r\n        </Form.Item>\r\n      ) : (\r\n        children\r\n      )}\r\n    </td>\r\n  );\r\n};\r\nconst { Option } = Select;\r\nconst renderDiffComponents = (item, indexs, ComponentInfo) => {\r\n  \r\n  switch (item.name) {\r\n    case 'Divider':\r\n      return <ComponentInfo key={indexs} {...item.attr}></ComponentInfo>\r\n    case 'Select':\r\n      return (\r\n        <ComponentInfo key={indexs} defaultValue={item.attr.value}>\r\n          {\r\n            item.attr.options.map(subItem => <Option key={subItem.key} value={subItem.value + ''}>{subItem.label}</Option>)\r\n          }\r\n        </ComponentInfo>\r\n      )\r\n    default:\r\n      return <ComponentInfo key={indexs} {...item.attr} />\r\n  }\r\n}\r\nconst GlobalTabel = (props) => {\r\n  const [form] = Form.useForm();\r\n  const data = props.dataSource\r\n  const firstFormId = props.firstFormId\r\n  const secondFormId = props.secondFormId\r\n  const [editingKey, setEditingKey] = useState('');\r\n  const del = props.del\r\n  const getData = props.getData\r\n  const updataData = props.updataData\r\n  let isLoading = props.loading\r\n  let page = { pageIndex: 1, pageSize: 2 }\r\n  const isEditing = (record) => record.key === editingKey;\r\n  const edit = (record) => {\r\n    setEditingKey(record.key);\r\n  };\r\n\r\n  const cancel = (e) => {\r\n    page.pageIndex = e.current;\r\n    setEditingKey('');\r\n  };\r\n\r\n  const save = async (key) => {\r\n    try {\r\n      const row = await form.validateFields();\r\n      const newData = [...data];\r\n      const index = newData.findIndex((item) => key === item.key);\r\n      if (index > -1) {\r\n        const item = newData[index];\r\n        newData.splice(index, 1, { ...item, ...row });\r\n      } else {\r\n        newData.push(row);\r\n      }\r\n      const item = newData[index];\r\n      let params = {}\r\n      params.firstFormId = firstFormId\r\n      params.secondFormId = secondFormId\r\n      params.dataId = item.id.toString()\r\n      Modal.confirm({\r\n        title: '提示',\r\n        content: '是否确认修改该条数据',\r\n        okText: '确认',\r\n        cancelText: '取消',\r\n        onOk() {\r\n          let newObj = {}\r\n          Object.keys(item).map((obj) => {\r\n            if (obj.startsWith('tenement')) {\r\n              newObj[obj] = item[obj]\r\n            }\r\n          })\r\n          params.updataData = newObj\r\n          updataData(params)\r\n          setEditingKey('')\r\n          message.success('修改成功')\r\n        },\r\n        onCancel() {\r\n          console.log('Cancel');\r\n        },\r\n      });\r\n    } catch (errInfo) {\r\n      console.log('Validate Failed:', errInfo);\r\n    }\r\n  };\r\n\r\n  const deleteRecord = (txt) => {\r\n    let params = {}\r\n    params.firstFormId = firstFormId\r\n    params.secondFormId = secondFormId\r\n    params.dataId = (txt.id).toString()\r\n    Modal.confirm({\r\n      title: '提示',\r\n      content: '是否确认删除该条数据',\r\n      okText: '确认',\r\n      cancelText: '取消',\r\n      onOk() {\r\n        del(params)\r\n        getData(page)\r\n        props.countObj(firstFormId);\r\n        setEditingKey('')\r\n        message.success('删除成功')\r\n      },\r\n      onCancel() {\r\n        console.log('Cancel');\r\n      },\r\n    });\r\n  }\r\n  const columns = props.columns\r\n  let obj = columns\r\n  const text = obj.pop()\r\n  if (text != undefined && !('align' in text)) {\r\n    obj.push(text)\r\n  }\r\n  obj.push({\r\n    align: 'right',\r\n    width: '20%',\r\n    title: '操作',\r\n    dataIndex: '操作',\r\n    render: (_, record) => {\r\n      const editable = isEditing(record);\r\n      return editable ? (\r\n        <span>\r\n          <a\r\n            onClick={() => save(record.key)}\r\n            style={{\r\n              marginRight: 8,\r\n            }}\r\n          >\r\n            Save\r\n          </a>\r\n          <Popconfirm title=\"Sure to cancel?\" onConfirm={cancel}>\r\n            <a>Cancel</a>\r\n          </Popconfirm>\r\n          <Divider type='vertical' />\r\n          <a onClick={() => deleteRecord(record)}>Delete</a>\r\n        </span>\r\n      ) : (\r\n        <span>\r\n          <a disabled={editingKey !== ''} onClick={() => edit(record)}>\r\n            Edit\r\n          </a>\r\n        </span>\r\n      );\r\n    },\r\n  })\r\n\r\n  for (let index = 0; index < columns.length - 4; index++) {\r\n    const element = columns[index];\r\n    element.editable = true\r\n  }\r\n  const mergedColumns = columns.map((col) => {\r\n    if (!col.editable) {\r\n      return col;\r\n    }\r\n    console.log(col);\r\n    return {\r\n      ...col,\r\n      onCell: (record) => ({\r\n        record,\r\n        inputType: col.type,\r\n        dataIndex: col.dataIndex,\r\n        title: col.title,\r\n        editing: isEditing(record),\r\n      }),\r\n    };\r\n  });\r\n  return (\r\n    <Form form={form} component={false}>\r\n      <Table\r\n        components={{\r\n          body: {\r\n            cell: EditableCell,\r\n          },\r\n        }}\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowClassName=\"editable-row\"\r\n        pagination={props.PageInfo}\r\n        onChange={cancel}\r\n        loading={isLoading}\r\n      />\r\n    </Form>\r\n  );\r\n\r\n\r\n};\r\n\r\nexport default GlobalTabel\r\n\r\n"]},"metadata":{},"sourceType":"module"}